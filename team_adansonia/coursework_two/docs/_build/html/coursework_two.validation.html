

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>coursework_two.validation package &mdash; Team Adansonia  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="coursework_two.utils package" href="coursework_two.utils.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Team Adansonia
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">coursework_two</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="coursework_two.html">coursework_two package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="coursework_two.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="coursework_two.data_pipeline.html">coursework_two.data_pipeline package</a></li>
<li class="toctree-l4"><a class="reference internal" href="coursework_two.fast_api.html">coursework_two.fast_api package</a></li>
<li class="toctree-l4"><a class="reference internal" href="coursework_two.frontend.html">coursework_two.frontend package</a></li>
<li class="toctree-l4"><a class="reference internal" href="coursework_two.mongo_db.html">coursework_two.mongo_db package</a></li>
<li class="toctree-l4"><a class="reference internal" href="coursework_two.utils.html">coursework_two.utils package</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">coursework_two.validation package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="coursework_two.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="coursework_two.html#module-coursework_two.main">coursework_two.main module</a></li>
<li class="toctree-l3"><a class="reference internal" href="coursework_two.html#module-coursework_two">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Team Adansonia</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">coursework_two</a></li>
          <li class="breadcrumb-item"><a href="coursework_two.html">coursework_two package</a></li>
      <li class="breadcrumb-item active">coursework_two.validation package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/coursework_two.validation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="coursework-two-validation-package">
<h1>coursework_two.validation package<a class="headerlink" href="#coursework-two-validation-package" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-coursework_two.validation.deepseek_validation">
<span id="coursework-two-validation-deepseek-validation-module"></span><h2>coursework_two.validation.deepseek_validation module<a class="headerlink" href="#module-coursework_two.validation.deepseek_validation" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="coursework_two.validation.deepseek_validation.create_validation_prompt">
<span class="sig-prename descclassname"><span class="pre">coursework_two.validation.deepseek_validation.</span></span><span class="sig-name descname"><span class="pre">create_validation_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">esg_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filtered_text</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">company_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coursework_two/validation/deepseek_validation.html#create_validation_prompt"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#coursework_two.validation.deepseek_validation.create_validation_prompt" title="Link to this definition"></a></dt>
<dd><p>Construct a prompt for DeepSeek API to validate ESG data using relevant text excerpts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>esg_data</strong> (<em>dict</em>) – Extracted ESG data.</p></li>
<li><p><strong>filtered_text</strong> (<em>str</em>) – Text from PDF pages with relevant keywords.</p></li>
<li><p><strong>company_name</strong> (<em>str</em>) – Name of the company being evaluated.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A formatted prompt string for validation.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="coursework_two.validation.deepseek_validation.extract_json_from_markdown">
<span class="sig-prename descclassname"><span class="pre">coursework_two.validation.deepseek_validation.</span></span><span class="sig-name descname"><span class="pre">extract_json_from_markdown</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coursework_two/validation/deepseek_validation.html#extract_json_from_markdown"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#coursework_two.validation.deepseek_validation.extract_json_from_markdown" title="Link to this definition"></a></dt>
<dd><p>Extract JSON content from a markdown-formatted block of text.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>text</strong> (<em>str</em>) – Raw text that may include a markdown JSON block.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Extracted JSON string.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="coursework_two.validation.deepseek_validation.extract_metric_keywords">
<span class="sig-prename descclassname"><span class="pre">coursework_two.validation.deepseek_validation.</span></span><span class="sig-name descname"><span class="pre">extract_metric_keywords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">esg_data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coursework_two/validation/deepseek_validation.html#extract_metric_keywords"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#coursework_two.validation.deepseek_validation.extract_metric_keywords" title="Link to this definition"></a></dt>
<dd><p>Recursively extract top-level keys that contain metric-like values from ESG data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>esg_data</strong> (<em>dict</em>) – ESG data dictionary.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of potential metric keywords found in the ESG data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="coursework_two.validation.deepseek_validation.extract_relevant_pages">
<span class="sig-prename descclassname"><span class="pre">coursework_two.validation.deepseek_validation.</span></span><span class="sig-name descname"><span class="pre">extract_relevant_pages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdf_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keywords</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coursework_two/validation/deepseek_validation.html#extract_relevant_pages"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#coursework_two.validation.deepseek_validation.extract_relevant_pages" title="Link to this definition"></a></dt>
<dd><p>Extract pages from the PDF that mention any of the specified keywords.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pdf_path</strong> (<em>str</em>) – Path to the PDF file.</p></li>
<li><p><strong>keywords</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – List of keywords to match.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Concatenated text from relevant pages.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="coursework_two.validation.deepseek_validation.get_first_n_tokens">
<span class="sig-prename descclassname"><span class="pre">coursework_two.validation.deepseek_validation.</span></span><span class="sig-name descname"><span class="pre">get_first_n_tokens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_text</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_tokens</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coursework_two/validation/deepseek_validation.html#get_first_n_tokens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#coursework_two.validation.deepseek_validation.get_first_n_tokens" title="Link to this definition"></a></dt>
<dd><p>Truncates a given text to the first <cite>n_tokens</cite> tokens using tiktoken encoding.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_text</strong> (<em>str</em>) – The full text input.</p></li>
<li><p><strong>n_tokens</strong> (<em>int</em>) – Number of tokens to include.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Truncated string containing only the first <cite>n_tokens</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="coursework_two.validation.deepseek_validation.main">
<span class="sig-prename descclassname"><span class="pre">coursework_two.validation.deepseek_validation.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/coursework_two/validation/deepseek_validation.html#main"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#coursework_two.validation.deepseek_validation.main" title="Link to this definition"></a></dt>
<dd><p>Main execution entry point for validating ESG data using DeepSeek AI.</p>
<ul class="simple">
<li><p>Loads a sample ESG data dictionary.</p></li>
<li><p>Loads and filters a local PDF.</p></li>
<li><p>Sends validation request to DeepSeek and prints the result.</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="coursework_two.validation.deepseek_validation.validate_esg_data_with_deepseek">
<span class="sig-prename descclassname"><span class="pre">coursework_two.validation.deepseek_validation.</span></span><span class="sig-name descname"><span class="pre">validate_esg_data_with_deepseek</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">esg_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">company_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pdf_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coursework_two/validation/deepseek_validation.html#validate_esg_data_with_deepseek"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#coursework_two.validation.deepseek_validation.validate_esg_data_with_deepseek" title="Link to this definition"></a></dt>
<dd><p>Validates ESG data against filtered text from a PDF using DeepSeek’s LLM.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pdf_path</strong> (<em>str</em>) – Path to the filtered CSR report PDF.</p></li>
<li><p><strong>esg_data</strong> (<em>dict</em>) – Extracted ESG metrics.</p></li>
<li><p><strong>company_name</strong> (<em>str</em>) – The company name for context.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>ESG data with updated ‘validated’ fields based on LLM’s analysis.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – If API call fails or response is invalid.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-coursework_two.validation.validation">
<span id="coursework-two-validation-validation-module"></span><h2>coursework_two.validation.validation module<a class="headerlink" href="#module-coursework_two.validation.validation" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="coursework_two.validation.validation.full_validation_pipeline">
<span class="sig-prename descclassname"><span class="pre">coursework_two.validation.validation.</span></span><span class="sig-name descname"><span class="pre">full_validation_pipeline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parsed_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filtered_text</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">company_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pdf_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coursework_two/validation/validation.html#full_validation_pipeline"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#coursework_two.validation.validation.full_validation_pipeline" title="Link to this definition"></a></dt>
<dd><p>Runs the full validation pipeline for ESG data by first performing internal validation, and then using OpenAI
for further validation. If OpenAI validation fails, it falls back to using the internally validated data.</p>
<p>Parameters:
- parsed_data (dict): The raw ESG data that needs validation.
- filtered_text (str): The filtered text from the ESG report used to verify the data.
- company_name (str): The name of the company to help contextualize the validation.</p>
<p>Returns:
- corrected_data (dict): The validated ESG data, which may have been further corrected by OpenAI.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="coursework_two.validation.validation.validate_and_clean_data">
<span class="sig-prename descclassname"><span class="pre">coursework_two.validation.validation.</span></span><span class="sig-name descname"><span class="pre">validate_and_clean_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filtered_text</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coursework_two/validation/validation.html#validate_and_clean_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#coursework_two.validation.validation.validate_and_clean_data" title="Link to this definition"></a></dt>
<dd><p>Cleans and validates raw ESG data by verifying the values and units, ensuring they conform to expected formats
and lie within predefined ranges. This function also checks if the value appears in the filtered ESG report text.</p>
<p>Parameters:
- raw_data (dict): The raw ESG data to be validated and cleaned, typically structured by categories and metrics.
- filtered_text (str): The filtered text from the ESG report used to check if values appear in the report.</p>
<p>Returns:
- cleaned (dict): A dictionary containing cleaned and validated ESG data with issues removed.
- issues (list): A list of dictionaries detailing any issues found during the validation process, including missing values,</p>
<blockquote>
<div><p>unrecognized units, and mismatches between the raw data and filtered text.</p>
</div></blockquote>
</dd></dl>

</section>
<section id="module-coursework_two.validation">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-coursework_two.validation" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="coursework_two.utils.html" class="btn btn-neutral float-left" title="coursework_two.utils package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Balazs.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>