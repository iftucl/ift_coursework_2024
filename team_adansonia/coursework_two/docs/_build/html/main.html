

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Main &mdash; Team Adansonia  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Data Pipeline" href="data_pipeline.html" />
    <link rel="prev" title="Team Adansonia Project Docs" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Team Adansonia
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Main</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main.export_updated_seed_file"><code class="docutils literal notranslate"><span class="pre">export_updated_seed_file()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#main.get_unextracted_symbol_years_mongo"><code class="docutils literal notranslate"><span class="pre">get_unextracted_symbol_years_mongo()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#main.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#main.run_end_to_end_workflow"><code class="docutils literal notranslate"><span class="pre">run_end_to_end_workflow()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#main.run_main_for_symbols"><code class="docutils literal notranslate"><span class="pre">run_main_for_symbols()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data_pipeline.html">Data Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="fast_api.html">Fast API</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontend.html">Frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongo_db.html">Mongo DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduler.html">Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="validation.html">Validation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Team Adansonia</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Main</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/main.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-main">
<span id="main"></span><h1>Main<a class="headerlink" href="#module-main" title="Link to this heading"></a></h1>
<p>End-to-End ESG Data Extraction and MongoDB Integration Script</p>
<p>This module orchestrates the full data pipeline for extracting Environmental, Social,
and Governance (ESG) data from CSR reports using AI-powered tools (LLaMA and DeepSeek),
processing it, validating it, storing it in MongoDB, and exporting the result to a seed JSON file.</p>
<p>Main Functions:
- run_end_to_end_workflow: Processes a company’s CSR report and extracts ESG data and goals.
- run_main_for_symbols: Batch processes a list of company symbols and updates the database.
- export_updated_seed_file: Dumps the MongoDB ‘companies’ collection to a JSON seed file.
- main: Main loop for processing all companies in the database (used for bulk updates).</p>
<dl class="py function">
<dt class="sig sig-object py" id="main.export_updated_seed_file">
<span class="sig-prename descclassname"><span class="pre">main.</span></span><span class="sig-name descname"><span class="pre">export_updated_seed_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'seed_data.json'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/main.html#export_updated_seed_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#main.export_updated_seed_file" title="Link to this definition"></a></dt>
<dd><p>Exports current MongoDB company data into a JSON seed file.</p>
<p>Handles ISO conversion for dates and string conversion for ObjectIds.</p>
<p>Parameters:
- db: MongoDB database connection.
- seed_file (str): Filename for the seed output (default: “seed_data.json”).</p>
<p>Returns:
- None</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="main.get_unextracted_symbol_years_mongo">
<span class="sig-prename descclassname"><span class="pre">main.</span></span><span class="sig-name descname"><span class="pre">get_unextracted_symbol_years_mongo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/main.html#get_unextracted_symbol_years_mongo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#main.get_unextracted_symbol_years_mongo" title="Link to this definition"></a></dt>
<dd><p>Retrieves a list of company symbols and years for which ESG data has not been extracted.</p>
<p>This function searches through the companies collection in the MongoDB database and checks
each company’s CSR report links to find years that have not yet been processed for ESG data.
It returns a list of up to n such (symbol, year) pairs.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="main.main">
<span class="sig-prename descclassname"><span class="pre">main.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/main.html#main"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#main.main" title="Link to this definition"></a></dt>
<dd><p>Runs the full ESG data extraction workflow for every company in the MongoDB database.</p>
<p>Only processes companies that are missing ESG data for the latest CSR report year.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="main.run_end_to_end_workflow">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">main.</span></span><span class="sig-name descname"><span class="pre">run_end_to_end_workflow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">company_symbol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">company_security</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/main.html#run_end_to_end_workflow"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#main.run_end_to_end_workflow" title="Link to this definition"></a></dt>
<dd><p>Executes the full ESG extraction workflow for a single company.</p>
<p>Steps:
1. Fetch CSR report (filtered).
2. Run LLaMA extractor on PDF.
3. Run ESG data validation pipeline.
4. Extract goals using DeepSeek.</p>
<p>Parameters:
- company_symbol (str): The stock ticker symbol of the company.
- company_security (str): The full name of the company.
- db: MongoDB database connection.
- year (int or None): Optional CSR report year to target.</p>
<p>Returns:
- tuple: (validated_esg_data: dict, esg_goals: dict)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="main.run_main_for_symbols">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">main.</span></span><span class="sig-name descname"><span class="pre">run_main_for_symbols</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbols_with_years</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/main.html#run_main_for_symbols"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#main.run_main_for_symbols" title="Link to this definition"></a></dt>
<dd><p>Executes the ESG extraction pipeline for a given list of company symbols and target years.</p>
<p>Parameters:
- symbols_with_years (list[tuple[str, str | None]]): List of (symbol, year) pairs.</p>
<p>Returns:
- None</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Team Adansonia Project Docs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="data_pipeline.html" class="btn btn-neutral float-right" title="Data Pipeline" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Balazs.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>