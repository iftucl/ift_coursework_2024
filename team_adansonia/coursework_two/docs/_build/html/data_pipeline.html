

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Pipeline &mdash; Team Adansonia  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Fast API" href="fast_api.html" />
    <link rel="prev" title="Main" href="main.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Team Adansonia
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="main.html">Main</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.llama_extractor.LlamaExtractor"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data_pipeline.llama_extractor.LlamaExtractor.api_key"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor.api_key</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#data_pipeline.llama_extractor.LlamaExtractor.company_name"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor.company_name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#data_pipeline.llama_extractor.LlamaExtractor.filtered_pdf_path"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor.filtered_pdf_path</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id0"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor.api_key</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor.company_name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#data_pipeline.llama_extractor.LlamaExtractor.extract_energy_metrics"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor.extract_energy_metrics()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#data_pipeline.llama_extractor.LlamaExtractor.extract_scope_emissions"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor.extract_scope_emissions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#data_pipeline.llama_extractor.LlamaExtractor.extract_water_metrics"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor.extract_water_metrics()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor.filtered_pdf_path</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#data_pipeline.llama_extractor.LlamaExtractor.model_config"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor.model_config</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#data_pipeline.llama_extractor.LlamaExtractor.process"><code class="docutils literal notranslate"><span class="pre">LlamaExtractor.process()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.csr_utils.connect_to_mongo"><code class="docutils literal notranslate"><span class="pre">connect_to_mongo()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.csr_utils.download_pdf"><code class="docutils literal notranslate"><span class="pre">download_pdf()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.csr_utils.filter_pdf_pages"><code class="docutils literal notranslate"><span class="pre">filter_pdf_pages()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.csr_utils.get_company_data_by_symbol"><code class="docutils literal notranslate"><span class="pre">get_company_data_by_symbol()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.csr_utils.get_latest_report_url"><code class="docutils literal notranslate"><span class="pre">get_latest_report_url()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.csr_utils.get_latest_report_year"><code class="docutils literal notranslate"><span class="pre">get_latest_report_year()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.csr_utils.process_csr_report"><code class="docutils literal notranslate"><span class="pre">process_csr_report()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.csr_utils.run_end_to_end_workflow"><code class="docutils literal notranslate"><span class="pre">run_end_to_end_workflow()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.goals_extractor.DEEPSEEK_API_KEY"><code class="docutils literal notranslate"><span class="pre">DEEPSEEK_API_KEY</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.goals_extractor.call_deepseek_find_goals"><code class="docutils literal notranslate"><span class="pre">call_deepseek_find_goals()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.goals_extractor.data_formatting"><code class="docutils literal notranslate"><span class="pre">data_formatting()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.goals_extractor.extract_emissions_data_by_page"><code class="docutils literal notranslate"><span class="pre">extract_emissions_data_by_page()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.goals_extractor.extract_goals_by_page"><code class="docutils literal notranslate"><span class="pre">extract_goals_by_page()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data_pipeline.goals_extractor.extract_goals_by_paragraph"><code class="docutils literal notranslate"><span class="pre">extract_goals_by_paragraph()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fast_api.html">Fast API</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontend.html">Frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongo_db.html">Mongo DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduler.html">Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="validation.html">Validation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Team Adansonia</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Data Pipeline</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/data_pipeline.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-data_pipeline.llama_extractor">
<span id="data-pipeline"></span><h1>Data Pipeline<a class="headerlink" href="#module-data_pipeline.llama_extractor" title="Link to this heading">ÔÉÅ</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="data_pipeline.llama_extractor.LlamaExtractor">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">data_pipeline.llama_extractor.</span></span><span class="sig-name descname"><span class="pre">LlamaExtractor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">api_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'llx-AnBpGNnjRf9xSLoteBAnreGs7oyYg0ynNU9zglgDOmXX5ch6'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">company_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filtered_pdf_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/llama_extractor.html#LlamaExtractor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.llama_extractor.LlamaExtractor" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseModel</span></code></p>
<p>An asynchronous PDF extractor that uses the LlamaParse API to extract sustainability-related</p>
<p>metrics (Scope 1 and 2 emissions, energy consumption, and water usage) from a filtered corporate PDF.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="data_pipeline.llama_extractor.LlamaExtractor.api_key">
<span class="sig-name descname"><span class="pre">api_key</span></span><a class="headerlink" href="#data_pipeline.llama_extractor.LlamaExtractor.api_key" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>LlamaParse API key.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="data_pipeline.llama_extractor.LlamaExtractor.company_name">
<span class="sig-name descname"><span class="pre">company_name</span></span><a class="headerlink" href="#data_pipeline.llama_extractor.LlamaExtractor.company_name" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Name of the company being processed.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="data_pipeline.llama_extractor.LlamaExtractor.filtered_pdf_path">
<span class="sig-name descname"><span class="pre">filtered_pdf_path</span></span><a class="headerlink" href="#data_pipeline.llama_extractor.LlamaExtractor.filtered_pdf_path" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Path to the filtered PDF report.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id0">
<span class="sig-name descname"><span class="pre">api_key</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#id0" title="Link to this definition">ÔÉÅ</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id1">
<span class="sig-name descname"><span class="pre">company_name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#id1" title="Link to this definition">ÔÉÅ</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="data_pipeline.llama_extractor.LlamaExtractor.extract_energy_metrics">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">extract_energy_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdf_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">company_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="reference internal" href="_modules/data_pipeline/llama_extractor.html#LlamaExtractor.extract_energy_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.llama_extractor.LlamaExtractor.extract_energy_metrics" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Extracts energy consumption data (total, renewable, non-renewable).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pdf_file</strong> (<em>str</em>) ‚Äì Path to the PDF file.</p></li>
<li><p><strong>company_name</strong> (<em>str</em>) ‚Äì Name of the company.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Energy metrics in structured JSON format.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="data_pipeline.llama_extractor.LlamaExtractor.extract_scope_emissions">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">extract_scope_emissions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdf_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">company_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="reference internal" href="_modules/data_pipeline/llama_extractor.html#LlamaExtractor.extract_scope_emissions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.llama_extractor.LlamaExtractor.extract_scope_emissions" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Extracts Scope 1 and Scope 2 emissions data from the PDF.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pdf_file</strong> (<em>str</em>) ‚Äì Path to the PDF file.</p></li>
<li><p><strong>company_name</strong> (<em>str</em>) ‚Äì Name of the company.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Emissions data in structured JSON format.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="data_pipeline.llama_extractor.LlamaExtractor.extract_water_metrics">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">extract_water_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdf_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">company_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="reference internal" href="_modules/data_pipeline/llama_extractor.html#LlamaExtractor.extract_water_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.llama_extractor.LlamaExtractor.extract_water_metrics" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Extracts water usage or intensity data from the PDF.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pdf_file</strong> (<em>str</em>) ‚Äì Path to the PDF file.</p></li>
<li><p><strong>company_name</strong> (<em>str</em>) ‚Äì Name of the company.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Water usage data in structured JSON format.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id2">
<span class="sig-name descname"><span class="pre">filtered_pdf_path</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#id2" title="Link to this definition">ÔÉÅ</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="data_pipeline.llama_extractor.LlamaExtractor.model_config">
<span class="sig-name descname"><span class="pre">model_config</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">ClassVar</span><span class="p"><span class="pre">[</span></span><span class="pre">ConfigDict</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{}</span></em><a class="headerlink" href="#data_pipeline.llama_extractor.LlamaExtractor.model_config" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Configuration for the model, should be a dictionary conforming to [<cite>ConfigDict</cite>][pydantic.config.ConfigDict].</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="data_pipeline.llama_extractor.LlamaExtractor.process">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="reference internal" href="_modules/data_pipeline/llama_extractor.html#LlamaExtractor.process"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.llama_extractor.LlamaExtractor.process" title="Link to this definition">ÔÉÅ</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function" id="module-data_pipeline.csr_utils">
<dt class="sig sig-object py" id="data_pipeline.csr_utils.connect_to_mongo">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.csr_utils.</span></span><span class="sig-name descname"><span class="pre">connect_to_mongo</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/csr_utils.html#connect_to_mongo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.csr_utils.connect_to_mongo" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Establishes a connection to the local MongoDB server.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A MongoClient instance if successful, otherwise None.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>MongoClient or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.csr_utils.download_pdf">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.csr_utils.</span></span><span class="sig-name descname"><span class="pre">download_pdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">BytesIO</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/data_pipeline/csr_utils.html#download_pdf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.csr_utils.download_pdf" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Downloads a PDF from a given URL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>url</strong> (<em>str</em>) ‚Äì The URL of the PDF file.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A stream of the downloaded PDF content, or None if download failed.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>BytesIO or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.csr_utils.filter_pdf_pages">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.csr_utils.</span></span><span class="sig-name descname"><span class="pre">filter_pdf_pages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdf_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BytesIO</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">BytesIO</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/data_pipeline/csr_utils.html#filter_pdf_pages"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.csr_utils.filter_pdf_pages" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Filters relevant pages from the PDF that contain ESG-related keywords and time series data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pdf_data</strong> (<em>BytesIO</em>) ‚Äì The original PDF content.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A tuple containing:</dt><dd><ul class="simple">
<li><p>The filtered PDF content as a BytesIO object.</p></li>
<li><p>Extracted relevant text as a lowercase string.</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[BytesIO, str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.csr_utils.get_company_data_by_symbol">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.csr_utils.</span></span><span class="sig-name descname"><span class="pre">get_company_data_by_symbol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/csr_utils.html#get_company_data_by_symbol"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.csr_utils.get_company_data_by_symbol" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Retrieves company data from the MongoDB database using the company‚Äôs stock symbol.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>symbol</strong> (<em>str</em>) ‚Äì The stock symbol of the company.</p></li>
<li><p><strong>db</strong> (<em>Database</em>) ‚Äì The MongoDB database instance.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The company‚Äôs data if found, otherwise None.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.csr_utils.get_latest_report_url">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.csr_utils.</span></span><span class="sig-name descname"><span class="pre">get_latest_report_url</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">csr_reports</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/csr_utils.html#get_latest_report_url"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.csr_utils.get_latest_report_url" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Retrieves a specific or the most recent CSR report URL from the company‚Äôs CSR report metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>csr_reports</strong> (<em>dict</em>) ‚Äì A dictionary mapping years to CSR report URLs.</p></li>
<li><p><strong>year</strong> (<em>int</em><em>, </em><em>optional</em>) ‚Äì The specific year to retrieve the report for.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The URL of the CSR report for the given year, or the most recent one available.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.csr_utils.get_latest_report_year">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.csr_utils.</span></span><span class="sig-name descname"><span class="pre">get_latest_report_year</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">csr_reports</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/csr_utils.html#get_latest_report_year"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.csr_utils.get_latest_report_year" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Retrieves the most recent CSR report year key that has a non-empty, non-null URL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>csr_reports</strong> (<em>dict</em>) ‚Äì A dictionary mapping years to CSR report URLs.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The latest year with a valid report URL, or None if not found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.csr_utils.process_csr_report">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.csr_utils.</span></span><span class="sig-name descname"><span class="pre">process_csr_report</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">company_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/csr_utils.html#process_csr_report"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.csr_utils.process_csr_report" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Downloads and filters the latest CSR report for a company.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>company_data</strong> (<em>dict</em>) ‚Äì A dictionary containing company information and CSR report URLs.</p></li>
<li><p><strong>year</strong> (<em>str</em><em>, </em><em>optional</em>) ‚Äì The specific year to retrieve the report for. If None, the most recent report is used.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The filtered PDF and extracted text, or (None, None) if no relevant content is found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[BytesIO, str] or (None, None)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.csr_utils.run_end_to_end_workflow">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.csr_utils.</span></span><span class="sig-name descname"><span class="pre">run_end_to_end_workflow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">company_symbol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">company_security</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/csr_utils.html#run_end_to_end_workflow"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.csr_utils.run_end_to_end_workflow" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Runs the end-to-end ESG extraction and validation workflow for a given company symbol and security.
This includes fetching the company‚Äôs CSR report, extracting ESG data using LlamaExtractor,
and validating the data using internal checks and OpenAI. It also extracts the company‚Äôs ESG goals.</p>
<p>Parameters:
- company_symbol (str): The stock symbol of the company.
- company_security (str): The security identifier of the company.
- db: MongoDB database connection.</p>
<p>Returns:
- final_data (dict): Validated and cleaned ESG data.
- goals (dict): Extracted ESG goals for the company.</p>
</dd></dl>

<dl class="py data" id="module-data_pipeline.goals_extractor">
<dt class="sig sig-object py" id="data_pipeline.goals_extractor.DEEPSEEK_API_KEY">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.goals_extractor.</span></span><span class="sig-name descname"><span class="pre">DEEPSEEK_API_KEY</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'sk-b3201bc343cc44fbb1f1b62ff8c2a5cd'</span></em><a class="headerlink" href="#data_pipeline.goals_extractor.DEEPSEEK_API_KEY" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>This module provides tools to extract emissions and sustainability goal information
from corporate PDF reports using PyPDF2 and DeepSeek language models.</p>
<p>Functions include:
- Extracting emissions and goals data by page or paragraph
- Formatting emissions data units
- Summarizing goals and emissions via DeepSeek API</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.goals_extractor.call_deepseek_find_goals">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.goals_extractor.</span></span><span class="sig-name descname"><span class="pre">call_deepseek_find_goals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">company_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pdf_text</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/goals_extractor.html#call_deepseek_find_goals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.goals_extractor.call_deepseek_find_goals" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Uses DeepSeek LLM to summarize emissions reduction targets from PDF content.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>company_name</strong> (<em>str</em>) ‚Äì Name of the company.</p></li>
<li><p><strong>pdf_text</strong> (<em>str</em>) ‚Äì Relevant text extracted from PDF.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Summary of emissions goals.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.goals_extractor.data_formatting">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.goals_extractor.</span></span><span class="sig-name descname"><span class="pre">data_formatting</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/goals_extractor.html#data_formatting"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.goals_extractor.data_formatting" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Converts textual emission data to a standardized numeric format with proper unit conversion.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>text</strong> (<em>re.Match</em>) ‚Äì Regex match group containing numeric and unit data.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Converted emission value in metric tonnes as string.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.goals_extractor.extract_emissions_data_by_page">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.goals_extractor.</span></span><span class="sig-name descname"><span class="pre">extract_emissions_data_by_page</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdf_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/goals_extractor.html#extract_emissions_data_by_page"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.goals_extractor.extract_emissions_data_by_page" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Extracts emissions-related pages from a PDF based on keyword and year matching.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pdf_path</strong> (<em>str</em>) ‚Äì Path to the PDF file.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Extracted text containing emissions-related content.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.goals_extractor.extract_goals_by_page">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.goals_extractor.</span></span><span class="sig-name descname"><span class="pre">extract_goals_by_page</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdf_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/goals_extractor.html#extract_goals_by_page"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.goals_extractor.extract_goals_by_page" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Extracts pages discussing sustainability or emissions goals.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pdf_path</strong> (<em>str</em>) ‚Äì Path to the PDF file.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Extracted text containing goals-related content.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="data_pipeline.goals_extractor.extract_goals_by_paragraph">
<span class="sig-prename descclassname"><span class="pre">data_pipeline.goals_extractor.</span></span><span class="sig-name descname"><span class="pre">extract_goals_by_paragraph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdf_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/data_pipeline/goals_extractor.html#extract_goals_by_paragraph"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#data_pipeline.goals_extractor.extract_goals_by_paragraph" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Extracts relevant paragraphs from a PDF that contain sustainability goals.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pdf_path</strong> (<em>str</em>) ‚Äì Path to the PDF file.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Extracted text containing goal-related paragraphs.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="main.html" class="btn btn-neutral float-left" title="Main" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="fast_api.html" class="btn btn-neutral float-right" title="Fast API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Balazs.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>