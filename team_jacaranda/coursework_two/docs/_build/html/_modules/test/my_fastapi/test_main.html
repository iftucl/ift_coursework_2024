<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>test.my_fastapi.test_main &#8212; Bigdata_cw2_Jacaranda 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for test.my_fastapi.test_main</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module: test_main</span>

<span class="sd">This module contains test cases for the FastAPI application endpoints.</span>
<span class="sd">It uses pytest and unittest.mock to test various endpoints that interact</span>
<span class="sd">with a database, returning indicator, data, and report information. The tests</span>
<span class="sd">cover scenarios such as successful retrieval, search with parameters, and error handling.</span>

<span class="sd">Each test mocks the database query (`query_db`) to return predefined values,</span>
<span class="sd">allowing for consistent and controlled test execution.</span>

<span class="sd">Test cases include:</span>
<span class="sd">- Retrieving all indicators.</span>
<span class="sd">- Searching for indicators by name or theme.</span>
<span class="sd">- Retrieving data by ID.</span>
<span class="sd">- Searching for data based on multiple parameters.</span>
<span class="sd">- Handling of reports and errors (e.g., not found).</span>

<span class="sd">The tests verify the status codes, response structures, and expected behaviors of the API.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.testclient</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">my_fastapi.main</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">unittest.mock</span><span class="w"> </span><span class="kn">import</span> <span class="n">patch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<div class="viewcode-block" id="test_get_indicators">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_get_indicators">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;indicator_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;indicator_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Energy&quot;</span><span class="p">}])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_get_indicators</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /indicators endpoint.</span>

<span class="sd">    This test ensures that the endpoint returns a list of indicators with the correct structure.</span>
<span class="sd">    It verifies that the response status is 200 and that the &#39;indicator_name&#39; of the first item is &quot;Energy&quot;.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to return predefined data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/indicators&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="nb">list</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;indicator_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Energy&quot;</span></div>


<div class="viewcode-block" id="test_search_indicators_no_match">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_search_indicators_no_match">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_search_indicators_no_match</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /indicators/search endpoint with no matching indicators.</span>

<span class="sd">    This test ensures that when no matching indicators are found, the response is an empty list.</span>
<span class="sd">    It verifies that the response status is 200 and the JSON body is an empty list.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to return an empty list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/indicators/search?indicator_name=Water&amp;theme=Climate&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="test_search_indicators_with_name_and_theme">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_search_indicators_with_name_and_theme">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;indicator_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;indicator_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Waste&quot;</span><span class="p">,</span> <span class="s2">&quot;theme&quot;</span><span class="p">:</span> <span class="s2">&quot;Climate&quot;</span><span class="p">}])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_search_indicators_with_name_and_theme</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /indicators/search endpoint with matching indicators.</span>

<span class="sd">    This test ensures that the endpoint returns matching indicators when searching by name and theme.</span>
<span class="sd">    It verifies that the response status is 200 and the returned data is a list.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to return predefined matching data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/indicators/search?indicator_name=Waste&amp;theme=Climate&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="nb">list</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_get_indicator_by_id">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_get_indicator_by_id">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;indicator_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;indicator_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Water&quot;</span><span class="p">}])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_get_indicator_by_id</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /indicators/{id} endpoint by ID.</span>

<span class="sd">    This test ensures that the endpoint correctly retrieves an indicator by its ID.</span>
<span class="sd">    It verifies that the response status is 200 and that the indicator name matches &quot;Water&quot;.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to return predefined data for the specified ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/indicators/2&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;indicator_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Water&quot;</span></div>


<div class="viewcode-block" id="test_get_indicator_not_found">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_get_indicator_not_found">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_get_indicator_not_found</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /indicators/{id} endpoint when the indicator is not found.</span>

<span class="sd">    This test ensures that the endpoint returns a 404 status code when the requested indicator does not exist.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to simulate no data being found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/indicators/999999&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span></div>


<div class="viewcode-block" id="test_get_all_data">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_get_all_data">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;data_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;security&quot;</span><span class="p">:</span> <span class="s2">&quot;ABC Corp&quot;</span><span class="p">}])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_get_all_data</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /data endpoint.</span>

<span class="sd">    This test ensures that the endpoint returns a list of data items with the correct structure.</span>
<span class="sd">    It verifies that the response status is 200 and that the returned data is a list.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to return predefined data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/data&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="nb">list</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_search_data_all_params">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_search_data_all_params">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_search_data_all_params</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /data/search endpoint with all search parameters.</span>

<span class="sd">    This test ensures that the endpoint returns no data when searching with specific parameters.</span>
<span class="sd">    It verifies that the response status is 200 and the returned data is an empty list.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to simulate no data matching the search parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/data/search?security=ABC&amp;report_year=2023&amp;indicator_id=1&amp;indicator_name=Energy&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="test_search_data_no_param">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_search_data_no_param">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_search_data_no_param</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /data/search endpoint with no search parameters.</span>

<span class="sd">    This test ensures that the endpoint returns an empty list when no parameters are provided.</span>
<span class="sd">    It verifies that the response status is 200 and the returned data is an empty list.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to simulate no data when no parameters are provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/data/search&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="test_get_data_by_id">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_get_data_by_id">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;data_id&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;indicator_name&quot;</span><span class="p">:</span> <span class="s2">&quot;CO2&quot;</span><span class="p">}])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_get_data_by_id</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /data/{id} endpoint by ID.</span>

<span class="sd">    This test ensures that the endpoint correctly retrieves data by its ID.</span>
<span class="sd">    It verifies that the response status is 200 and the data ID is 100.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to return predefined data for the specified ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/data/100&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;data_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">100</span></div>


<div class="viewcode-block" id="test_get_data_by_id_not_found">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_get_data_by_id_not_found">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_get_data_by_id_not_found</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /data/{id} endpoint when the data is not found.</span>

<span class="sd">    This test ensures that the endpoint returns a 404 status code when the requested data is not found.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to simulate no data being found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/data/999999&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span></div>


<div class="viewcode-block" id="test_get_reports">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_get_reports">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="s2">&quot;XYZ&quot;</span><span class="p">}])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_get_reports</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /reports endpoint.</span>

<span class="sd">    This test ensures that the endpoint returns a list of reports with the correct structure.</span>
<span class="sd">    It verifies that the response status is 200 and the returned data is a list.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to return predefined data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/reports&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="nb">list</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_search_reports_all_params">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_search_reports_all_params">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="s2">&quot;ZZZ&quot;</span><span class="p">,</span> <span class="s2">&quot;security&quot;</span><span class="p">:</span> <span class="s2">&quot;Example&quot;</span><span class="p">,</span> <span class="s2">&quot;report_year&quot;</span><span class="p">:</span> <span class="mi">2022</span><span class="p">}])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_search_reports_all_params</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /reports/search endpoint with all search parameters.</span>

<span class="sd">    This test ensures that the endpoint returns matching reports when searching with specific parameters.</span>
<span class="sd">    It verifies that the response status is 200 and the returned data is a list.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to return predefined data for the search parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/reports/search?symbol=ZZZ&amp;security=Example&amp;report_year=2022&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="nb">list</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_search_reports">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_search_reports">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_search_reports</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /reports/search endpoint with a partial search parameter.</span>

<span class="sd">    This test ensures that the endpoint returns a list of reports even when only a partial search parameter is provided.</span>
<span class="sd">    It verifies that the response status is 200 and the returned data is a list.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to return predefined data for the search.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/reports/search?symbol=XYZ&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="nb">list</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_get_company_report_by_id">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_get_company_report_by_id">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="s2">&quot;XYZ&quot;</span><span class="p">}])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_get_company_report_by_id</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /reports/{id} endpoint by report ID.</span>

<span class="sd">    This test ensures that the endpoint correctly retrieves a report by its ID.</span>
<span class="sd">    It verifies that the response status is 200 and the report contains the &#39;symbol&#39; field.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to return predefined data for the specified report ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/reports/1&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="s2">&quot;symbol&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></div>


<div class="viewcode-block" id="test_get_report_not_found">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_get_report_not_found">[docs]</a>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.query_db&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">[])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_get_report_not_found</span><span class="p">(</span><span class="n">mock_query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the GET /reports/{id} endpoint when the report is not found.</span>

<span class="sd">    This test ensures that the endpoint returns a 404 status code when the requested report is not found.</span>

<span class="sd">    :param mock_query: The mocked query_db function used to simulate no data being found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/reports/99999&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span></div>


<div class="viewcode-block" id="test_root_frontend_redirect">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_root_frontend_redirect">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">test_root_frontend_redirect</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the root URL for frontend redirect behavior.</span>

<span class="sd">    This test ensures that the root URL either returns index.html or a 404 error depending on the </span>
<span class="sd">    availability of the frontend build directory. The test mocks the existence of the directory.</span>

<span class="sd">    :param monkeypatch: A pytest fixture that allows patching functions for testing purposes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="s2">&quot;os.path.exists&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="s2">&quot;my_fastapi.main.frontend_build_dir&quot;</span><span class="p">,</span> <span class="s2">&quot;fakepath&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">404</span><span class="p">]</span>  <span class="c1"># Path may not exist</span></div>


<div class="viewcode-block" id="test_favicon">
<a class="viewcode-back" href="../../../test.my_fastapi.html#test.my_fastapi.test_main.test_favicon">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">test_favicon</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the favicon endpoint.</span>

<span class="sd">    This test ensures that the favicon URL returns a valid response (either 200 or 404) depending </span>
<span class="sd">    on the existence of the favicon file.</span>

<span class="sd">    :param monkeypatch: A pytest fixture that allows patching functions for testing purposes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="s2">&quot;os.path.exists&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/favicon.ico&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">404</span><span class="p">]</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Bigdata_cw2_Jacaranda</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">modules package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../my_fastapi.html">my_fastapi package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../test.html">test package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Roger.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>