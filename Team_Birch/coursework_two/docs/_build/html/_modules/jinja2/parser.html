

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>jinja2.parser &mdash; Coursework Two 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Coursework Two
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation_guide.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage_instructions.html">Usage Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture_overview.html">Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Coursework Two</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">jinja2.parser</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for jinja2.parser</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Parse tokens from the lexer into nodes for the compiler.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">typing</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">t</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">nodes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TemplateAssertionError</span><span class="p">,</span> <span class="n">TemplateSyntaxError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.lexer</span><span class="w"> </span><span class="kn">import</span> <span class="n">describe_token</span><span class="p">,</span> <span class="n">describe_token_expr</span>

<span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">te</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.environment</span><span class="w"> </span><span class="kn">import</span> <span class="n">Environment</span>

<span class="n">_ImportInclude</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_ImportInclude&quot;</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Import</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Include</span><span class="p">)</span>
<span class="n">_MacroCall</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_MacroCall&quot;</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Macro</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">CallBlock</span><span class="p">)</span>

<span class="n">_statement_keywords</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;for&quot;</span><span class="p">,</span>
        <span class="s2">&quot;if&quot;</span><span class="p">,</span>
        <span class="s2">&quot;block&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extends&quot;</span><span class="p">,</span>
        <span class="s2">&quot;print&quot;</span><span class="p">,</span>
        <span class="s2">&quot;macro&quot;</span><span class="p">,</span>
        <span class="s2">&quot;include&quot;</span><span class="p">,</span>
        <span class="s2">&quot;from&quot;</span><span class="p">,</span>
        <span class="s2">&quot;import&quot;</span><span class="p">,</span>
        <span class="s2">&quot;set&quot;</span><span class="p">,</span>
        <span class="s2">&quot;with&quot;</span><span class="p">,</span>
        <span class="s2">&quot;autoescape&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">_compare_operators</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span><span class="s2">&quot;eq&quot;</span><span class="p">,</span> <span class="s2">&quot;ne&quot;</span><span class="p">,</span> <span class="s2">&quot;lt&quot;</span><span class="p">,</span> <span class="s2">&quot;lteq&quot;</span><span class="p">,</span> <span class="s2">&quot;gt&quot;</span><span class="p">,</span> <span class="s2">&quot;gteq&quot;</span><span class="p">])</span>

<span class="n">_math_nodes</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;add&quot;</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span>
    <span class="s2">&quot;sub&quot;</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Sub</span><span class="p">,</span>
    <span class="s2">&quot;mul&quot;</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Mul</span><span class="p">,</span>
    <span class="s2">&quot;div&quot;</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span>
    <span class="s2">&quot;floordiv&quot;</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">FloorDiv</span><span class="p">,</span>
    <span class="s2">&quot;mod&quot;</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Mod</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="Parser">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Parser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the central parsing class Jinja uses.  It&#39;s passed to</span>
<span class="sd">    extensions and can be used to parse expressions or statements.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">environment</span><span class="p">:</span> <span class="s2">&quot;Environment&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<div class="viewcode-block" id="Parser.environment">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.environment">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span></div>

<div class="viewcode-block" id="Parser.stream">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.stream">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">_tokenize</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.name">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.name">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span></div>

<div class="viewcode-block" id="Parser.filename">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.filename">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span></div>

<div class="viewcode-block" id="Parser.closed">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.closed">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Parser.extensions">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.extensions">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">extensions</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Parser</span><span class="p">],</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>

        <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">environment</span><span class="o">.</span><span class="n">iter_extensions</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">extension</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extensions</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">extension</span><span class="o">.</span><span class="n">parse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_identifier</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tag_stack</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_token_stack</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Parser.fail">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.fail">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fail</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">lineno</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exc</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">TemplateSyntaxError</span><span class="p">]</span> <span class="o">=</span> <span class="n">TemplateSyntaxError</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;te.NoReturn&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convenience method that raises `exc` with the message, passed</span>
<span class="sd">        line number or last line number as well as the current name and</span>
<span class="sd">        filename.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">lineno</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">raise</span> <span class="n">exc</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_fail_ut_eof</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">end_token_stack</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span>
        <span class="n">lineno</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;te.NoReturn&quot;</span><span class="p">:</span>
        <span class="n">expected</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">exprs</span> <span class="ow">in</span> <span class="n">end_token_stack</span><span class="p">:</span>
            <span class="n">expected</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">describe_token_expr</span><span class="p">,</span> <span class="n">exprs</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">end_token_stack</span><span class="p">:</span>
            <span class="n">currently_looking</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">describe_token_expr</span><span class="p">,</span> <span class="n">end_token_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">currently_looking</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Unexpected end of template.&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Encountered unknown tag </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">currently_looking</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">expected</span><span class="p">:</span>
                <span class="n">message</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;You probably made a nesting mistake. Jinja is expecting this tag,&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; but currently looking for </span><span class="si">{</span><span class="n">currently_looking</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Jinja was looking for the following tags: </span><span class="si">{</span><span class="n">currently_looking</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tag_stack</span><span class="p">:</span>
            <span class="n">message</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;The innermost block that needs to be closed is&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_tag_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">!r}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">lineno</span><span class="p">)</span>

<div class="viewcode-block" id="Parser.fail_unknown_tag">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.fail_unknown_tag">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fail_unknown_tag</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lineno</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;te.NoReturn&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called if the parser encounters an unknown tag.  Tries to fail</span>
<span class="sd">        with a human readable error message that could help to identify</span>
<span class="sd">        the problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fail_ut_eof</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_token_stack</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.fail_eof">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.fail_eof">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fail_eof</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">end_tokens</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">lineno</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;te.NoReturn&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Like fail_unknown_tag but for end of template situations.&quot;&quot;&quot;</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_token_stack</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">end_tokens</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_tokens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fail_ut_eof</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.is_tuple_end">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.is_tuple_end">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_tuple_end</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">extra_end_rules</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Are we at the end of a tuple?&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;variable_end&quot;</span><span class="p">,</span> <span class="s2">&quot;block_end&quot;</span><span class="p">,</span> <span class="s2">&quot;rparen&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">extra_end_rules</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">test_any</span><span class="p">(</span><span class="n">extra_end_rules</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Parser.free_identifier">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.free_identifier">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">free_identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineno</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">InternalName</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a new free identifier as :class:`~jinja2.nodes.InternalName`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_identifier</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">InternalName</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;fi</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_identifier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rv</span></div>


<div class="viewcode-block" id="Parser.parse_statement">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_statement">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a single statement.&quot;&quot;&quot;</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;tag name expected&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tag_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">pop_tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="n">_statement_keywords</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;parse_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">f</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_call_block</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;filter&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_filter_block</span><span class="p">()</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ext</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># did not work out, remove the token we pushed by accident</span>
            <span class="c1"># from the stack so that the unknown tag fail function can</span>
            <span class="c1"># produce a proper error message.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tag_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">pop_tag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail_unknown_tag</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pop_tag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tag_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>


<div class="viewcode-block" id="Parser.parse_statements">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_statements">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_statements</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">end_tokens</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">drop_needle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse multiple statements into a list until one of the end tokens</span>
<span class="sd">        is reached.  This is used to parse the body of statements as it also</span>
<span class="sd">        parses template data if appropriate.  The parser checks first if the</span>
<span class="sd">        current token is a colon and skips it if there is one.  Then it checks</span>
<span class="sd">        for the block end and parses until if one of the `end_tokens` is</span>
<span class="sd">        reached.  Per default the active token in the stream at the end of</span>
<span class="sd">        the call is the matched end token.  If this is not wanted `drop_needle`</span>
<span class="sd">        can be set to `True` and the end token is removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># the first token may be a colon for python compatibility</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;colon&quot;</span><span class="p">)</span>

        <span class="c1"># in the future it would be possible to add whole code sections</span>
        <span class="c1"># by adding some sort of end of statement token and parsing those here.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;block_end&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subparse</span><span class="p">(</span><span class="n">end_tokens</span><span class="p">)</span>

        <span class="c1"># we reached the end of the template too early, the subparser</span>
        <span class="c1"># does not check for this, so we do that now</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;eof&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail_eof</span><span class="p">(</span><span class="n">end_tokens</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">drop_needle</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="Parser.parse_set">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_set">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Assign</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">AssignBlock</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse an assign statement.&quot;&quot;&quot;</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_assign_target</span><span class="p">(</span><span class="n">with_namespace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;assign&quot;</span><span class="p">):</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_tuple</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">filter_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_filter</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statements</span><span class="p">((</span><span class="s2">&quot;name:endset&quot;</span><span class="p">,),</span> <span class="n">drop_needle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">AssignBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">filter_node</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_for">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_for">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_for</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">For</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a for loop.&quot;&quot;&quot;</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name:for&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_assign_target</span><span class="p">(</span><span class="n">extra_end_rules</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;name:in&quot;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name:in&quot;</span><span class="p">)</span>
        <span class="nb">iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_tuple</span><span class="p">(</span>
            <span class="n">with_condexpr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extra_end_rules</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;name:recursive&quot;</span><span class="p">,)</span>
        <span class="p">)</span>
        <span class="n">test</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;name:if&quot;</span><span class="p">):</span>
            <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
        <span class="n">recursive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;name:recursive&quot;</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statements</span><span class="p">((</span><span class="s2">&quot;name:endfor&quot;</span><span class="p">,</span> <span class="s2">&quot;name:else&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;endfor&quot;</span><span class="p">:</span>
            <span class="n">else_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">else_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statements</span><span class="p">((</span><span class="s2">&quot;name:endfor&quot;</span><span class="p">,),</span> <span class="n">drop_needle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">For</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">else_</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_if">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_if">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_if</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">If</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse an if construct.&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">result</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name:if&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_tuple</span><span class="p">(</span><span class="n">with_condexpr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statements</span><span class="p">((</span><span class="s2">&quot;name:elif&quot;</span><span class="p">,</span> <span class="s2">&quot;name:else&quot;</span><span class="p">,</span> <span class="s2">&quot;name:endif&quot;</span><span class="p">))</span>
            <span class="n">node</span><span class="o">.</span><span class="n">elif_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">node</span><span class="o">.</span><span class="n">else_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">token</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="s2">&quot;name:elif&quot;</span><span class="p">):</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">elif_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="s2">&quot;name:else&quot;</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">else_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statements</span><span class="p">((</span><span class="s2">&quot;name:endif&quot;</span><span class="p">,),</span> <span class="n">drop_needle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="Parser.parse_with">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_with">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_with</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">With</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">With</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">targets</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;block_end&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">targets</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;comma&quot;</span><span class="p">)</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_assign_target</span><span class="p">()</span>
            <span class="n">target</span><span class="o">.</span><span class="n">set_ctx</span><span class="p">(</span><span class="s2">&quot;param&quot;</span><span class="p">)</span>
            <span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;assign&quot;</span><span class="p">)</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">())</span>
        <span class="n">node</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>
        <span class="n">node</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="n">node</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statements</span><span class="p">((</span><span class="s2">&quot;name:endwith&quot;</span><span class="p">,),</span> <span class="n">drop_needle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_autoescape">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_autoescape">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_autoescape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Scope</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">ScopedEvalContextModifier</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;autoescape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">())]</span>
        <span class="n">node</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statements</span><span class="p">((</span><span class="s2">&quot;name:endautoescape&quot;</span><span class="p">,),</span> <span class="n">drop_needle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Scope</span><span class="p">([</span><span class="n">node</span><span class="p">])</span></div>


<div class="viewcode-block" id="Parser.parse_block">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_block">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_block</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Block</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">node</span><span class="o">.</span><span class="n">scoped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;name:scoped&quot;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;name:required&quot;</span><span class="p">)</span>

        <span class="c1"># common problem people encounter when switching from django</span>
        <span class="c1"># to jinja.  we do not support hyphens in block names, so let&#39;s</span>
        <span class="c1"># raise a nicer error message in that case.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;sub&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span>
                <span class="s2">&quot;Block names in Jinja have to be valid Python identifiers and may not&quot;</span>
                <span class="s2">&quot; contain hyphens, use an underscore instead.&quot;</span>
            <span class="p">)</span>

        <span class="n">node</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statements</span><span class="p">((</span><span class="s2">&quot;name:endblock&quot;</span><span class="p">,),</span> <span class="n">drop_needle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># enforce that required blocks only contain whitespace or comments</span>
        <span class="c1"># by asserting that the body, if not empty, is just TemplateData nodes</span>
        <span class="c1"># with whitespace data</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">body_node</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">body_node</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Output</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_node</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">TemplateData</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="ow">not</span> <span class="n">output_node</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">output_node</span> <span class="ow">in</span> <span class="n">body_node</span><span class="o">.</span><span class="n">nodes</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Required blocks can only contain comments or whitespace&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;name:&quot;</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_extends">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_extends">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_extends</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Extends</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Extends</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_import_context">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_import_context">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_import_context</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">_ImportInclude</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ImportInclude</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">test_any</span><span class="p">(</span>
            <span class="s2">&quot;name:with&quot;</span><span class="p">,</span> <span class="s2">&quot;name:without&quot;</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">look</span><span class="p">()</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="s2">&quot;name:context&quot;</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">with_context</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;with&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">with_context</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_include">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_include">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_include</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Include</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Include</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="s2">&quot;name:ignore&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">look</span><span class="p">()</span><span class="o">.</span><span class="n">test</span><span class="p">(</span>
            <span class="s2">&quot;name:missing&quot;</span>
        <span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">ignore_missing</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">ignore_missing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_import_context</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_import">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_import">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_import</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Import</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Import</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name:as&quot;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_assign_target</span><span class="p">(</span><span class="n">name_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_import_context</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_from">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_from">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_from</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">FromImport</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">FromImport</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name:import&quot;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">parse_context</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="p">{</span>
                <span class="s2">&quot;with&quot;</span><span class="p">,</span>
                <span class="s2">&quot;without&quot;</span><span class="p">,</span>
            <span class="p">}</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">look</span><span class="p">()</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="s2">&quot;name:context&quot;</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">with_context</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;with&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;comma&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parse_context</span><span class="p">():</span>
                    <span class="k">break</span>
                <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_assign_target</span><span class="p">(</span><span class="n">name_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span>
                        <span class="s2">&quot;names starting with an underline can not be imported&quot;</span><span class="p">,</span>
                        <span class="n">target</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                        <span class="n">exc</span><span class="o">=</span><span class="n">TemplateAssertionError</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;name:as&quot;</span><span class="p">):</span>
                    <span class="n">alias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_assign_target</span><span class="p">(</span><span class="n">name_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">alias</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">parse_context</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;comma&quot;</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;with_context&quot;</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">with_context</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_signature">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_signature">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">_MacroCall</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;lparen&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;rparen&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;comma&quot;</span><span class="p">)</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_assign_target</span><span class="p">(</span><span class="n">name_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">arg</span><span class="o">.</span><span class="n">set_ctx</span><span class="p">(</span><span class="s2">&quot;param&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;assign&quot;</span><span class="p">):</span>
                <span class="n">defaults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">defaults</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;non-default argument follows default argument&quot;</span><span class="p">)</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;rparen&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_call_block">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_call_block">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_call_block</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">CallBlock</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">CallBlock</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;lparen&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_signature</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">node</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">call_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">call_node</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Call</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;expected call&quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">call</span> <span class="o">=</span> <span class="n">call_node</span>
        <span class="n">node</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statements</span><span class="p">((</span><span class="s2">&quot;name:endcall&quot;</span><span class="p">,),</span> <span class="n">drop_needle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_filter_block">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_filter_block">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_filter_block</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">FilterBlock</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">FilterBlock</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">node</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statements</span><span class="p">((</span><span class="s2">&quot;name:endfilter&quot;</span><span class="p">,),</span> <span class="n">drop_needle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_macro">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_macro">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_macro</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Macro</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Macro</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_assign_target</span><span class="p">(</span><span class="n">name_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_signature</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statements</span><span class="p">((</span><span class="s2">&quot;name:endmacro&quot;</span><span class="p">,),</span> <span class="n">drop_needle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_print">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_print">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Output</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;block_end&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;comma&quot;</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">node</span></div>


    <span class="nd">@typing</span><span class="o">.</span><span class="n">overload</span>
<div class="viewcode-block" id="Parser.parse_assign_target">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_assign_target">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_assign_target</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">with_tuple</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span> <span class="n">name_only</span><span class="p">:</span> <span class="s2">&quot;te.Literal[True]&quot;</span> <span class="o">=</span> <span class="o">...</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Name</span><span class="p">:</span>
        <span class="o">...</span></div>


    <span class="nd">@typing</span><span class="o">.</span><span class="n">overload</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_assign_target</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">with_tuple</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">name_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">extra_end_rules</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">with_namespace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">NSRef</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Tuple</span><span class="p">]:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_assign_target</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">with_tuple</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">name_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">extra_end_rules</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">with_namespace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">NSRef</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Tuple</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse an assignment target.  As Jinja allows assignments to</span>
<span class="sd">        tuples, this function can parse all allowed assignment targets.  Per</span>
<span class="sd">        default assignments to tuples are parsed, that can be disable however</span>
<span class="sd">        by setting `with_tuple` to `False`.  If only assignments to names are</span>
<span class="sd">        wanted `name_only` can be set to `True`.  The `extra_end_rules`</span>
<span class="sd">        parameter is forwarded to the tuple parsing function.  If</span>
<span class="sd">        `with_namespace` is enabled, a namespace assignment may be parsed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span>

        <span class="k">if</span> <span class="n">name_only</span><span class="p">:</span>
            <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">with_tuple</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_tuple</span><span class="p">(</span>
                    <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">extra_end_rules</span><span class="o">=</span><span class="n">extra_end_rules</span><span class="p">,</span>
                    <span class="n">with_namespace</span><span class="o">=</span><span class="n">with_namespace</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_primary</span><span class="p">(</span><span class="n">with_namespace</span><span class="o">=</span><span class="n">with_namespace</span><span class="p">)</span>

            <span class="n">target</span><span class="o">.</span><span class="n">set_ctx</span><span class="p">(</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="o">.</span><span class="n">can_assign</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;can&#39;t assign to </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">lineno</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">target</span>  <span class="c1"># type: ignore</span>

<div class="viewcode-block" id="Parser.parse_expression">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_expression">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_condexpr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse an expression.  Per default all expressions are parsed, if</span>
<span class="sd">        the optional `with_condexpr` parameter is set to `False` conditional</span>
<span class="sd">        expressions are not parsed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">with_condexpr</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_condexpr</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_or</span><span class="p">()</span></div>


<div class="viewcode-block" id="Parser.parse_condexpr">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_condexpr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_condexpr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">expr1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_or</span><span class="p">()</span>
        <span class="n">expr3</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;name:if&quot;</span><span class="p">):</span>
            <span class="n">expr2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_or</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;name:else&quot;</span><span class="p">):</span>
                <span class="n">expr3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_condexpr</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expr3</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">expr1</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">CondExpr</span><span class="p">(</span><span class="n">expr2</span><span class="p">,</span> <span class="n">expr1</span><span class="p">,</span> <span class="n">expr3</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">return</span> <span class="n">expr1</span></div>


<div class="viewcode-block" id="Parser.parse_or">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_or">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_or</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_and</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;name:or&quot;</span><span class="p">):</span>
            <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_and</span><span class="p">()</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">return</span> <span class="n">left</span></div>


<div class="viewcode-block" id="Parser.parse_and">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_and">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_and</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_not</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;name:and&quot;</span><span class="p">):</span>
            <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_not</span><span class="p">()</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">return</span> <span class="n">left</span></div>


<div class="viewcode-block" id="Parser.parse_not">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_not">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_not</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="s2">&quot;name:not&quot;</span><span class="p">):</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">lineno</span>
            <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_not</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_compare</span><span class="p">()</span></div>


<div class="viewcode-block" id="Parser.parse_compare">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_compare">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_math1</span><span class="p">()</span>
        <span class="n">ops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">token_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span>
            <span class="k">if</span> <span class="n">token_type</span> <span class="ow">in</span> <span class="n">_compare_operators</span><span class="p">:</span>
                <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
                <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Operand</span><span class="p">(</span><span class="n">token_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_math1</span><span class="p">()))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip_if</span><span class="p">(</span><span class="s2">&quot;name:in&quot;</span><span class="p">):</span>
                <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Operand</span><span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_math1</span><span class="p">()))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="s2">&quot;name:not&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">look</span><span class="p">()</span><span class="o">.</span><span class="n">test</span><span class="p">(</span>
                <span class="s2">&quot;name:in&quot;</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Operand</span><span class="p">(</span><span class="s2">&quot;notin&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_math1</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ops</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">expr</span>
        <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ops</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_math1">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_math1">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_math1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_concat</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;sub&quot;</span><span class="p">):</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">_math_nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_concat</span><span class="p">()</span>
            <span class="n">left</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">return</span> <span class="n">left</span></div>


<div class="viewcode-block" id="Parser.parse_concat">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_concat">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_concat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_math2</span><span class="p">()]</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;tilde&quot;</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_math2</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Concat</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_math2">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_math2">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_math2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_pow</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;mul&quot;</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="s2">&quot;floordiv&quot;</span><span class="p">,</span> <span class="s2">&quot;mod&quot;</span><span class="p">):</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">_math_nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_pow</span><span class="p">()</span>
            <span class="n">left</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">return</span> <span class="n">left</span></div>


<div class="viewcode-block" id="Parser.parse_pow">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_pow">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_pow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_unary</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pow&quot;</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_unary</span><span class="p">()</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Pow</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">return</span> <span class="n">left</span></div>


<div class="viewcode-block" id="Parser.parse_unary">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_unary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_unary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="n">token_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span>

        <span class="k">if</span> <span class="n">token_type</span> <span class="o">==</span> <span class="s2">&quot;sub&quot;</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Neg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_unary</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">token_type</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Pos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_unary</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_primary</span><span class="p">()</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_postfix</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">with_filter</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_filter_expr</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_primary">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_primary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_primary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_namespace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a name or literal value. If ``with_namespace`` is enabled, also</span>
<span class="sd">        parse namespace attr refs, for use in assignments.&quot;&quot;&quot;</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">):</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Const</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">):</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Const</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">with_namespace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;dot&quot;</span><span class="p">:</span>
                <span class="c1"># If namespace attributes are allowed at this point, and the next</span>
                <span class="c1"># token is a dot, produce a namespace reference.</span>
                <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">NSRef</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
                <span class="n">buf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Const</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">):</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Const</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;lparen&quot;</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_tuple</span><span class="p">(</span><span class="n">explicit_parentheses</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;rparen&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;lbracket&quot;</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_list</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;lbrace&quot;</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unexpected </span><span class="si">{</span><span class="n">describe_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_tuple">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_tuple">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_tuple</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">simplified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_condexpr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">extra_end_rules</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">explicit_parentheses</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_namespace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Works like `parse_expression` but if multiple expressions are</span>
<span class="sd">        delimited by a comma a :class:`~jinja2.nodes.Tuple` node is created.</span>
<span class="sd">        This method could also return a regular expression instead of a tuple</span>
<span class="sd">        if no commas where found.</span>

<span class="sd">        The default parsing mode is a full tuple.  If `simplified` is `True`</span>
<span class="sd">        only names and literals are parsed; ``with_namespace`` allows namespace</span>
<span class="sd">        attr refs as well. The `no_condexpr` parameter is forwarded to</span>
<span class="sd">        :meth:`parse_expression`.</span>

<span class="sd">        Because tuples do not require delimiters and may end in a bogus comma</span>
<span class="sd">        an extra hint is needed that marks the end of a tuple.  For example</span>
<span class="sd">        for loops support tuples between `for` and `in`.  In that case the</span>
<span class="sd">        `extra_end_rules` is set to ``[&#39;name:in&#39;]``.</span>

<span class="sd">        `explicit_parentheses` is true if the parsing was triggered by an</span>
<span class="sd">        expression in parentheses.  This is used to figure out if an empty</span>
<span class="sd">        tuple is a valid expression or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="k">if</span> <span class="n">simplified</span><span class="p">:</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_primary</span><span class="p">(</span><span class="n">with_namespace</span><span class="o">=</span><span class="n">with_namespace</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">(</span><span class="n">with_condexpr</span><span class="o">=</span><span class="n">with_condexpr</span><span class="p">)</span>

        <span class="n">args</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">is_tuple</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;comma&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_tuple_end</span><span class="p">(</span><span class="n">extra_end_rules</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parse</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;comma&quot;</span><span class="p">:</span>
                <span class="n">is_tuple</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_tuple</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># if we don&#39;t have explicit parentheses, an empty tuple is</span>
            <span class="c1"># not a valid expression.  This would mean nothing (literally</span>
            <span class="c1"># nothing) in the spot of an expression would be an empty</span>
            <span class="c1"># tuple.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">explicit_parentheses</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span>
                    <span class="s2">&quot;Expected an expression,&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; got </span><span class="si">{</span><span class="n">describe_token</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="p">)</span><span class="si">!r}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_list">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">List</span><span class="p">:</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;lbracket&quot;</span><span class="p">)</span>
        <span class="n">items</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;rbracket&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">items</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;comma&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;rbracket&quot;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;rbracket&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_dict">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Dict</span><span class="p">:</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;lbrace&quot;</span><span class="p">)</span>
        <span class="n">items</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Pair</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;rbrace&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">items</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;comma&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;rbrace&quot;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;colon&quot;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Pair</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">lineno</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;rbrace&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_postfix">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_postfix">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_postfix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">token_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span>
            <span class="k">if</span> <span class="n">token_type</span> <span class="o">==</span> <span class="s2">&quot;dot&quot;</span> <span class="ow">or</span> <span class="n">token_type</span> <span class="o">==</span> <span class="s2">&quot;lbracket&quot;</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_subscript</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="c1"># calls are valid both after postfix expressions (getattr</span>
            <span class="c1"># and getitem) as well as filters and tests</span>
            <span class="k">elif</span> <span class="n">token_type</span> <span class="o">==</span> <span class="s2">&quot;lparen&quot;</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_call</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_filter_expr">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_filter_expr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_filter_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">token_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span>
            <span class="k">if</span> <span class="n">token_type</span> <span class="o">==</span> <span class="s2">&quot;pipe&quot;</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_filter</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">elif</span> <span class="n">token_type</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;is&quot;</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_test</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="c1"># calls are valid both after postfix expressions (getattr</span>
            <span class="c1"># and getitem) as well as filters and tests</span>
            <span class="k">elif</span> <span class="n">token_type</span> <span class="o">==</span> <span class="s2">&quot;lparen&quot;</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_call</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_subscript">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_subscript">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_subscript</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Getattr</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Getitem</span><span class="p">]:</span>
        <span class="n">token</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
        <span class="n">arg</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span>

        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;dot&quot;</span><span class="p">:</span>
            <span class="n">attr_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr_token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Getattr</span><span class="p">(</span>
                    <span class="n">node</span><span class="p">,</span> <span class="n">attr_token</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr_token</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;integer&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;expected name or number&quot;</span><span class="p">,</span> <span class="n">attr_token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Const</span><span class="p">(</span><span class="n">attr_token</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">attr_token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Getitem</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;lbracket&quot;</span><span class="p">:</span>
            <span class="n">args</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;rbracket&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;comma&quot;</span><span class="p">)</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_subscribed</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;rbracket&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Getitem</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;expected subscript expression&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_subscribed">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_subscribed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_subscribed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">]]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;colon&quot;</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;colon&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">node</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;colon&quot;</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;rbracket&quot;</span><span class="p">,</span> <span class="s2">&quot;comma&quot;</span><span class="p">):</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;colon&quot;</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;rbracket&quot;</span><span class="p">,</span> <span class="s2">&quot;comma&quot;</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Slice</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>  <span class="c1"># noqa: B026</span></div>


<div class="viewcode-block" id="Parser.parse_call_args">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_call_args">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_call_args</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span>
        <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">],</span>
        <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Keyword</span><span class="p">],</span>
        <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">],</span>
        <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">],</span>
    <span class="p">]:</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;lparen&quot;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dyn_args</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">dyn_kwargs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">require_comma</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">ensure</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">expr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;invalid syntax for function call expression&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;rparen&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">require_comma</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;comma&quot;</span><span class="p">)</span>

                <span class="c1"># support for trailing comma</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;rparen&quot;</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;mul&quot;</span><span class="p">:</span>
                <span class="n">ensure</span><span class="p">(</span><span class="n">dyn_args</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dyn_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
                <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
                <span class="n">dyn_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pow&quot;</span><span class="p">:</span>
                <span class="n">ensure</span><span class="p">(</span><span class="n">dyn_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
                <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
                <span class="n">dyn_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">look</span><span class="p">()</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;assign&quot;</span>
                <span class="p">):</span>
                    <span class="c1"># Parsing a kwarg</span>
                    <span class="n">ensure</span><span class="p">(</span><span class="n">dyn_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">()</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Keyword</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">lineno</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Parsing an arg</span>
                    <span class="n">ensure</span><span class="p">(</span><span class="n">dyn_args</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dyn_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">())</span>

            <span class="n">require_comma</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;rparen&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">dyn_args</span><span class="p">,</span> <span class="n">dyn_kwargs</span></div>


<div class="viewcode-block" id="Parser.parse_call">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Call</span><span class="p">:</span>
        <span class="c1"># The lparen will be expected in parse_call_args, but the lineno</span>
        <span class="c1"># needs to be recorded before the stream is advanced.</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">dyn_args</span><span class="p">,</span> <span class="n">dyn_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_call_args</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">dyn_args</span><span class="p">,</span> <span class="n">dyn_kwargs</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parser.parse_filter">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_filter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_filter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">],</span> <span class="n">start_inline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">]:</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;pipe&quot;</span> <span class="ow">or</span> <span class="n">start_inline</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">start_inline</span><span class="p">:</span>
                <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;dot&quot;</span><span class="p">:</span>
                <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;lparen&quot;</span><span class="p">:</span>
                <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">dyn_args</span><span class="p">,</span> <span class="n">dyn_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_call_args</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">dyn_args</span> <span class="o">=</span> <span class="n">dyn_kwargs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span>
                <span class="n">node</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">dyn_args</span><span class="p">,</span> <span class="n">dyn_kwargs</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span>
            <span class="p">)</span>
            <span class="n">start_inline</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.parse_test">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse_test">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
        <span class="n">token</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="s2">&quot;name:not&quot;</span><span class="p">):</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">negated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">negated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;dot&quot;</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dyn_args</span> <span class="o">=</span> <span class="n">dyn_kwargs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">kwargs</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Keyword</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;lparen&quot;</span><span class="p">:</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">dyn_args</span><span class="p">,</span> <span class="n">dyn_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_call_args</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="s2">&quot;integer&quot;</span><span class="p">,</span>
            <span class="s2">&quot;float&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lparen&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lbracket&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lbrace&quot;</span><span class="p">,</span>
        <span class="p">}</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">test_any</span><span class="p">(</span><span class="s2">&quot;name:else&quot;</span><span class="p">,</span> <span class="s2">&quot;name:or&quot;</span><span class="p">,</span> <span class="s2">&quot;name:and&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="s2">&quot;name:is&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;You cannot chain multiple tests with is&quot;</span><span class="p">)</span>
            <span class="n">arg_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_primary</span><span class="p">()</span>
            <span class="n">arg_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_postfix</span><span class="p">(</span><span class="n">arg_node</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg_node</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Test</span><span class="p">(</span>
            <span class="n">node</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">dyn_args</span><span class="p">,</span> <span class="n">dyn_kwargs</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">negated</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="Parser.subparse">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.subparse">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">subparse</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">end_tokens</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
        <span class="n">body</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data_buffer</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">add_data</span> <span class="o">=</span> <span class="n">data_buffer</span><span class="o">.</span><span class="n">append</span>

        <span class="k">if</span> <span class="n">end_tokens</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_token_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_tokens</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">flush_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_buffer</span><span class="p">:</span>
                <span class="n">lineno</span> <span class="o">=</span> <span class="n">data_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span>
                <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="n">data_buffer</span><span class="p">[:],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">))</span>
                <span class="k">del</span> <span class="n">data_buffer</span><span class="p">[:]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">:</span>
                <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span>
                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="n">add_data</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">TemplateData</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">))</span>
                    <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;variable_begin&quot;</span><span class="p">:</span>
                    <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
                    <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_tuple</span><span class="p">(</span><span class="n">with_condexpr</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;variable_end&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;block_begin&quot;</span><span class="p">:</span>
                    <span class="n">flush_data</span><span class="p">()</span>
                    <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">end_tokens</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">test_any</span><span class="p">(</span>
                        <span class="o">*</span><span class="n">end_tokens</span>
                    <span class="p">):</span>
                        <span class="k">return</span> <span class="n">body</span>
                    <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_statement</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;block_end&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;internal parsing error&quot;</span><span class="p">)</span>

            <span class="n">flush_data</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">end_tokens</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_end_token_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">body</span></div>


<div class="viewcode-block" id="Parser.parse">
<a class="viewcode-back" href="../../autoapi/jinja2/parser/index.html#jinja2.parser.Parser.parse">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Template</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the whole template into a `Template` node.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subparse</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">set_environment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>