

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>packaging.tags &mdash; Coursework Two 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Coursework Two
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation_guide.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage_instructions.html">Usage Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture_overview.html">Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Coursework Two</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">packaging.tags</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for packaging.tags</h1><div class="highlight"><pre>
<span></span><span class="c1"># This file is dual licensed under the terms of the Apache License, Version</span>
<span class="c1"># 2.0, and the BSD License. See the LICENSE file in the root of this repository</span>
<span class="c1"># for complete details.</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sysconfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">importlib.machinery</span><span class="w"> </span><span class="kn">import</span> <span class="n">EXTENSION_SUFFIXES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">_manylinux</span><span class="p">,</span> <span class="n">_musllinux</span>

<div class="viewcode-block" id="logger">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.logger">[docs]</a>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="PythonVersion">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.PythonVersion">[docs]</a>
<span class="n">PythonVersion</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></div>

<div class="viewcode-block" id="AppleVersion">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.AppleVersion">[docs]</a>
<span class="n">AppleVersion</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span></div>


<div class="viewcode-block" id="INTERPRETER_SHORT_NAMES">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.INTERPRETER_SHORT_NAMES">[docs]</a>
<span class="n">INTERPRETER_SHORT_NAMES</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;python&quot;</span><span class="p">:</span> <span class="s2">&quot;py&quot;</span><span class="p">,</span>  <span class="c1"># Generic.</span>
    <span class="s2">&quot;cpython&quot;</span><span class="p">:</span> <span class="s2">&quot;cp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pypy&quot;</span><span class="p">:</span> <span class="s2">&quot;pp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ironpython&quot;</span><span class="p">:</span> <span class="s2">&quot;ip&quot;</span><span class="p">,</span>
    <span class="s2">&quot;jython&quot;</span><span class="p">:</span> <span class="s2">&quot;jy&quot;</span><span class="p">,</span>
<span class="p">}</span></div>



<span class="n">_32_BIT_INTERPRETER</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>


<div class="viewcode-block" id="Tag">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.Tag">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Tag</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A representation of the tag triple for a wheel.</span>

<span class="sd">    Instances are considered immutable and thus are hashable. Equality checking</span>
<span class="sd">    is also supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_abi&quot;</span><span class="p">,</span> <span class="s2">&quot;_hash&quot;</span><span class="p">,</span> <span class="s2">&quot;_interpreter&quot;</span><span class="p">,</span> <span class="s2">&quot;_platform&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interpreter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">abi</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interpreter</span> <span class="o">=</span> <span class="n">interpreter</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_abi</span> <span class="o">=</span> <span class="n">abi</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># The __hash__ of every single element in a Set[Tag] will be evaluated each time</span>
        <span class="c1"># that a set calls its `.disjoint()` method, which may be called hundreds of</span>
        <span class="c1"># times when scanning a page of links for packages with tags matching that</span>
        <span class="c1"># Set[Tag]. Pre-computing the value here produces significant speedups for</span>
        <span class="c1"># downstream consumers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpreter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform</span><span class="p">))</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Tag.interpreter">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.Tag.interpreter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">interpreter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpreter</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Tag.abi">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.Tag.abi">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">abi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abi</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Tag.platform">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.Tag.platform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">platform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_hash</span><span class="p">)</span>  <span class="c1"># Short-circuit ASAP for perf reasons.</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_platform</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_platform</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_abi</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_abi</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpreter</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_interpreter</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpreter</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_abi</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_platform</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span></div>



<div class="viewcode-block" id="parse_tag">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.parse_tag">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">frozenset</span><span class="p">[</span><span class="n">Tag</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses the provided tag (e.g. `py3-none-any`) into a frozenset of Tag instances.</span>

<span class="sd">    Returning a set is required due to the possibility that the tag is a</span>
<span class="sd">    compressed tag set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">interpreters</span><span class="p">,</span> <span class="n">abis</span><span class="p">,</span> <span class="n">platforms</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">interpreter</span> <span class="ow">in</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">abi</span> <span class="ow">in</span> <span class="n">abis</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">platform_</span> <span class="ow">in</span> <span class="n">platforms</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Tag</span><span class="p">(</span><span class="n">interpreter</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">platform_</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_get_config_var</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">warn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">sysconfig</span><span class="o">.</span><span class="n">get_config_var</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">warn</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Config variable &#39;</span><span class="si">%s</span><span class="s2">&#39; is unset, Python ABI tag may be incorrect&quot;</span><span class="p">,</span> <span class="n">name</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_normalize_string</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_threaded_cpython</span><span class="p">(</span><span class="n">abis</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine if the ABI corresponds to a threaded (`--disable-gil`) build.</span>

<span class="sd">    The threaded builds are indicated by a &quot;t&quot; in the abiflags.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">abis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># expect e.g., cp313</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;cp\d+(.*)&quot;</span><span class="p">,</span> <span class="n">abis</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">abiflags</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">abiflags</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_abi3_applies</span><span class="p">(</span><span class="n">python_version</span><span class="p">:</span> <span class="n">PythonVersion</span><span class="p">,</span> <span class="n">threading</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine if the Python version supports abi3.</span>

<span class="sd">    PEP 384 was first implemented in Python 3.2. The threaded (`--disable-gil`)</span>
<span class="sd">    builds do not support abi3.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">python_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">python_version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">threading</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_cpython_abis</span><span class="p">(</span><span class="n">py_version</span><span class="p">:</span> <span class="n">PythonVersion</span><span class="p">,</span> <span class="n">warn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">py_version</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">py_version</span><span class="p">)</span>  <span class="c1"># To allow for version comparison.</span>
    <span class="n">abis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">_version_nodot</span><span class="p">(</span><span class="n">py_version</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">threading</span> <span class="o">=</span> <span class="n">debug</span> <span class="o">=</span> <span class="n">pymalloc</span> <span class="o">=</span> <span class="n">ucs4</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">with_debug</span> <span class="o">=</span> <span class="n">_get_config_var</span><span class="p">(</span><span class="s2">&quot;Py_DEBUG&quot;</span><span class="p">,</span> <span class="n">warn</span><span class="p">)</span>
    <span class="n">has_refcount</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s2">&quot;gettotalrefcount&quot;</span><span class="p">)</span>
    <span class="c1"># Windows doesn&#39;t set Py_DEBUG, so checking for support of debug-compiled</span>
    <span class="c1"># extension modules is the best option.</span>
    <span class="c1"># https://github.com/pypa/pip/issues/3383#issuecomment-173267692</span>
    <span class="n">has_ext</span> <span class="o">=</span> <span class="s2">&quot;_d.pyd&quot;</span> <span class="ow">in</span> <span class="n">EXTENSION_SUFFIXES</span>
    <span class="k">if</span> <span class="n">with_debug</span> <span class="ow">or</span> <span class="p">(</span><span class="n">with_debug</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">has_refcount</span> <span class="ow">or</span> <span class="n">has_ext</span><span class="p">)):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span>
    <span class="k">if</span> <span class="n">py_version</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_get_config_var</span><span class="p">(</span><span class="s2">&quot;Py_GIL_DISABLED&quot;</span><span class="p">,</span> <span class="n">warn</span><span class="p">):</span>
        <span class="n">threading</span> <span class="o">=</span> <span class="s2">&quot;t&quot;</span>
    <span class="k">if</span> <span class="n">py_version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
        <span class="n">with_pymalloc</span> <span class="o">=</span> <span class="n">_get_config_var</span><span class="p">(</span><span class="s2">&quot;WITH_PYMALLOC&quot;</span><span class="p">,</span> <span class="n">warn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">with_pymalloc</span> <span class="ow">or</span> <span class="n">with_pymalloc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pymalloc</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span>
        <span class="k">if</span> <span class="n">py_version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">unicode_size</span> <span class="o">=</span> <span class="n">_get_config_var</span><span class="p">(</span><span class="s2">&quot;Py_UNICODE_SIZE&quot;</span><span class="p">,</span> <span class="n">warn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">unicode_size</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">unicode_size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxunicode</span> <span class="o">==</span> <span class="mh">0x10FFFF</span>
            <span class="p">):</span>
                <span class="n">ucs4</span> <span class="o">=</span> <span class="s2">&quot;u&quot;</span>
    <span class="k">elif</span> <span class="n">debug</span><span class="p">:</span>
        <span class="c1"># Debug builds can also load &quot;normal&quot; extension modules.</span>
        <span class="c1"># We can also assume no UCS-4 or pymalloc requirement.</span>
        <span class="n">abis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cp</span><span class="si">{</span><span class="n">version</span><span class="si">}{</span><span class="n">threading</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">abis</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;cp</span><span class="si">{</span><span class="n">version</span><span class="si">}{</span><span class="n">threading</span><span class="si">}{</span><span class="n">debug</span><span class="si">}{</span><span class="n">pymalloc</span><span class="si">}{</span><span class="n">ucs4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">abis</span>


<div class="viewcode-block" id="cpython_tags">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.cpython_tags">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cpython_tags</span><span class="p">(</span>
    <span class="n">python_version</span><span class="p">:</span> <span class="n">PythonVersion</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">abis</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">platforms</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">warn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tag</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yields the tags for a CPython interpreter.</span>

<span class="sd">    The tags consist of:</span>
<span class="sd">    - cp&lt;python_version&gt;-&lt;abi&gt;-&lt;platform&gt;</span>
<span class="sd">    - cp&lt;python_version&gt;-abi3-&lt;platform&gt;</span>
<span class="sd">    - cp&lt;python_version&gt;-none-&lt;platform&gt;</span>
<span class="sd">    - cp&lt;less than python_version&gt;-abi3-&lt;platform&gt;  # Older Python versions down to 3.2.</span>

<span class="sd">    If python_version only specifies a major version then user-provided ABIs and</span>
<span class="sd">    the &#39;none&#39; ABItag will be used.</span>

<span class="sd">    If &#39;abi3&#39; or &#39;none&#39; are specified in &#39;abis&#39; then they will be yielded at</span>
<span class="sd">    their normal position and not at the beginning.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">python_version</span><span class="p">:</span>
        <span class="n">python_version</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">interpreter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cp</span><span class="si">{</span><span class="n">_version_nodot</span><span class="p">(</span><span class="n">python_version</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">abis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">python_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">abis</span> <span class="o">=</span> <span class="n">_cpython_abis</span><span class="p">(</span><span class="n">python_version</span><span class="p">,</span> <span class="n">warn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">abis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">abis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">abis</span><span class="p">)</span>
    <span class="c1"># &#39;abi3&#39; and &#39;none&#39; are explicitly handled later.</span>
    <span class="k">for</span> <span class="n">explicit_abi</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;abi3&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">abis</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">explicit_abi</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="n">platforms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">platforms</span> <span class="ow">or</span> <span class="n">platform_tags</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">abi</span> <span class="ow">in</span> <span class="n">abis</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">platform_</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Tag</span><span class="p">(</span><span class="n">interpreter</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">platform_</span><span class="p">)</span>

    <span class="n">threading</span> <span class="o">=</span> <span class="n">_is_threaded_cpython</span><span class="p">(</span><span class="n">abis</span><span class="p">)</span>
    <span class="n">use_abi3</span> <span class="o">=</span> <span class="n">_abi3_applies</span><span class="p">(</span><span class="n">python_version</span><span class="p">,</span> <span class="n">threading</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_abi3</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="p">(</span><span class="n">Tag</span><span class="p">(</span><span class="n">interpreter</span><span class="p">,</span> <span class="s2">&quot;abi3&quot;</span><span class="p">,</span> <span class="n">platform_</span><span class="p">)</span> <span class="k">for</span> <span class="n">platform_</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="p">(</span><span class="n">Tag</span><span class="p">(</span><span class="n">interpreter</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">platform_</span><span class="p">)</span> <span class="k">for</span> <span class="n">platform_</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">use_abi3</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">minor_version</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">python_version</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">platform_</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">_version_nodot</span><span class="p">((</span><span class="n">python_version</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">minor_version</span><span class="p">))</span>
                <span class="n">interpreter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cp</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">yield</span> <span class="n">Tag</span><span class="p">(</span><span class="n">interpreter</span><span class="p">,</span> <span class="s2">&quot;abi3&quot;</span><span class="p">,</span> <span class="n">platform_</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_generic_abi</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the ABI tag based on EXT_SUFFIX.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The following are examples of `EXT_SUFFIX`.</span>
    <span class="c1"># We want to keep the parts which are related to the ABI and remove the</span>
    <span class="c1"># parts which are related to the platform:</span>
    <span class="c1"># - linux:   &#39;.cpython-310-x86_64-linux-gnu.so&#39; =&gt; cp310</span>
    <span class="c1"># - mac:     &#39;.cpython-310-darwin.so&#39;           =&gt; cp310</span>
    <span class="c1"># - win:     &#39;.cp310-win_amd64.pyd&#39;             =&gt; cp310</span>
    <span class="c1"># - win:     &#39;.pyd&#39;                             =&gt; cp37 (uses _cpython_abis())</span>
    <span class="c1"># - pypy:    &#39;.pypy38-pp73-x86_64-linux-gnu.so&#39; =&gt; pypy38_pp73</span>
    <span class="c1"># - graalpy: &#39;.graalpy-38-native-x86_64-darwin.dylib&#39;</span>
    <span class="c1">#                                               =&gt; graalpy_38_native</span>

    <span class="n">ext_suffix</span> <span class="o">=</span> <span class="n">_get_config_var</span><span class="p">(</span><span class="s2">&quot;EXT_SUFFIX&quot;</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ext_suffix</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ext_suffix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemError</span><span class="p">(</span><span class="s2">&quot;invalid sysconfig.get_config_var(&#39;EXT_SUFFIX&#39;)&quot;</span><span class="p">)</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">ext_suffix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># CPython3.7 and earlier uses &quot;.pyd&quot; on Windows.</span>
        <span class="k">return</span> <span class="n">_cpython_abis</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">soabi</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">soabi</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;cpython&quot;</span><span class="p">):</span>
        <span class="c1"># non-windows</span>
        <span class="n">abi</span> <span class="o">=</span> <span class="s2">&quot;cp&quot;</span> <span class="o">+</span> <span class="n">soabi</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">soabi</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;cp&quot;</span><span class="p">):</span>
        <span class="c1"># windows</span>
        <span class="n">abi</span> <span class="o">=</span> <span class="n">soabi</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">soabi</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;pypy&quot;</span><span class="p">):</span>
        <span class="n">abi</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">soabi</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">soabi</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;graalpy&quot;</span><span class="p">):</span>
        <span class="n">abi</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">soabi</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">soabi</span><span class="p">:</span>
        <span class="c1"># pyston, ironpython, others?</span>
        <span class="n">abi</span> <span class="o">=</span> <span class="n">soabi</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">_normalize_string</span><span class="p">(</span><span class="n">abi</span><span class="p">)]</span>


<div class="viewcode-block" id="generic_tags">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.generic_tags">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generic_tags</span><span class="p">(</span>
    <span class="n">interpreter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">abis</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">platforms</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">warn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tag</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yields the tags for a generic interpreter.</span>

<span class="sd">    The tags consist of:</span>
<span class="sd">    - &lt;interpreter&gt;-&lt;abi&gt;-&lt;platform&gt;</span>

<span class="sd">    The &quot;none&quot; ABI will be added if it was not explicitly provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">interpreter</span><span class="p">:</span>
        <span class="n">interp_name</span> <span class="o">=</span> <span class="n">interpreter_name</span><span class="p">()</span>
        <span class="n">interp_version</span> <span class="o">=</span> <span class="n">interpreter_version</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="n">warn</span><span class="p">)</span>
        <span class="n">interpreter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">interp_name</span><span class="p">,</span> <span class="n">interp_version</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">abis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">abis</span> <span class="o">=</span> <span class="n">_generic_abi</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">abis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">abis</span><span class="p">)</span>
    <span class="n">platforms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">platforms</span> <span class="ow">or</span> <span class="n">platform_tags</span><span class="p">())</span>
    <span class="k">if</span> <span class="s2">&quot;none&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">abis</span><span class="p">:</span>
        <span class="n">abis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">abi</span> <span class="ow">in</span> <span class="n">abis</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">platform_</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Tag</span><span class="p">(</span><span class="n">interpreter</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">platform_</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_py_interpreter_range</span><span class="p">(</span><span class="n">py_version</span><span class="p">:</span> <span class="n">PythonVersion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yields Python versions in descending order.</span>

<span class="sd">    After the latest version, the major-only version will be yielded, and then</span>
<span class="sd">    all previous versions of that major version.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">py_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;py</span><span class="si">{</span><span class="n">_version_nodot</span><span class="p">(</span><span class="n">py_version</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;py</span><span class="si">{</span><span class="n">py_version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">py_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">minor</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">py_version</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;py</span><span class="si">{</span><span class="n">_version_nodot</span><span class="p">((</span><span class="n">py_version</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">minor</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>


<div class="viewcode-block" id="compatible_tags">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.compatible_tags">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">compatible_tags</span><span class="p">(</span>
    <span class="n">python_version</span><span class="p">:</span> <span class="n">PythonVersion</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">interpreter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">platforms</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tag</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yields the sequence of tags that are compatible with a specific version of Python.</span>

<span class="sd">    The tags consist of:</span>
<span class="sd">    - py*-none-&lt;platform&gt;</span>
<span class="sd">    - &lt;interpreter&gt;-none-any  # ... if `interpreter` is provided.</span>
<span class="sd">    - py*-none-any</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">python_version</span><span class="p">:</span>
        <span class="n">python_version</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">platforms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">platforms</span> <span class="ow">or</span> <span class="n">platform_tags</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">_py_interpreter_range</span><span class="p">(</span><span class="n">python_version</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">platform_</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Tag</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">platform_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interpreter</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">Tag</span><span class="p">(</span><span class="n">interpreter</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;any&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">_py_interpreter_range</span><span class="p">(</span><span class="n">python_version</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">Tag</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;any&quot;</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_mac_arch</span><span class="p">(</span><span class="n">arch</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_32bit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">_32_BIT_INTERPRETER</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_32bit</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arch</span>

    <span class="k">if</span> <span class="n">arch</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ppc&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;ppc&quot;</span>

    <span class="k">return</span> <span class="s2">&quot;i386&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_mac_binary_formats</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="n">AppleVersion</span><span class="p">,</span> <span class="n">cpu_arch</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="n">cpu_arch</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cpu_arch</span> <span class="o">==</span> <span class="s2">&quot;x86_64&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">formats</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;intel&quot;</span><span class="p">,</span> <span class="s2">&quot;fat64&quot;</span><span class="p">,</span> <span class="s2">&quot;fat32&quot;</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">cpu_arch</span> <span class="o">==</span> <span class="s2">&quot;i386&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">formats</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;intel&quot;</span><span class="p">,</span> <span class="s2">&quot;fat32&quot;</span><span class="p">,</span> <span class="s2">&quot;fat&quot;</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">cpu_arch</span> <span class="o">==</span> <span class="s2">&quot;ppc64&quot;</span><span class="p">:</span>
        <span class="c1"># TODO: Need to care about 32-bit PPC for ppc64 through 10.2?</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="ow">or</span> <span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;fat64&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">cpu_arch</span> <span class="o">==</span> <span class="s2">&quot;ppc&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">formats</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;fat32&quot;</span><span class="p">,</span> <span class="s2">&quot;fat&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">cpu_arch</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;arm64&quot;</span><span class="p">,</span> <span class="s2">&quot;x86_64&quot;</span><span class="p">}:</span>
        <span class="n">formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;universal2&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cpu_arch</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;x86_64&quot;</span><span class="p">,</span> <span class="s2">&quot;i386&quot;</span><span class="p">,</span> <span class="s2">&quot;ppc64&quot;</span><span class="p">,</span> <span class="s2">&quot;ppc&quot;</span><span class="p">,</span> <span class="s2">&quot;intel&quot;</span><span class="p">}:</span>
        <span class="n">formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;universal&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">formats</span>


<div class="viewcode-block" id="mac_platforms">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.mac_platforms">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mac_platforms</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">AppleVersion</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">arch</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yields the platform tags for a macOS system.</span>

<span class="sd">    The `version` parameter is a two-item tuple specifying the macOS version to</span>
<span class="sd">    generate platform tags for. The `arch` parameter is the CPU architecture to</span>
<span class="sd">    generate platform tags for. Both parameters default to the appropriate value</span>
<span class="sd">    for the current system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">version_str</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">cpu_arch</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">mac_ver</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;AppleVersion&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">version_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])))</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span>
            <span class="c1"># When built against an older macOS SDK, Python will report macOS 10.16</span>
            <span class="c1"># instead of the real version.</span>
            <span class="n">version_str</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
                    <span class="s2">&quot;-sS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;import platform; print(platform.mac_ver()[0])&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;SYSTEM_VERSION_COMPAT&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">},</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">stdout</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;AppleVersion&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">version_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
    <span class="k">if</span> <span class="n">arch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">_mac_arch</span><span class="p">(</span><span class="n">cpu_arch</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">arch</span>

    <span class="k">if</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">version</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1"># Prior to Mac OS 11, each yearly release of Mac OS bumped the</span>
        <span class="c1"># &quot;minor&quot; version number.  The major version was always 10.</span>
        <span class="n">major_version</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">for</span> <span class="n">minor_version</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">compat_version</span> <span class="o">=</span> <span class="n">major_version</span><span class="p">,</span> <span class="n">minor_version</span>
            <span class="n">binary_formats</span> <span class="o">=</span> <span class="n">_mac_binary_formats</span><span class="p">(</span><span class="n">compat_version</span><span class="p">,</span> <span class="n">arch</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">binary_format</span> <span class="ow">in</span> <span class="n">binary_formats</span><span class="p">:</span>
                <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;macosx_</span><span class="si">{</span><span class="n">major_version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">minor_version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">binary_format</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">version</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1"># Starting with Mac OS 11, each yearly release bumps the major version</span>
        <span class="c1"># number.   The minor versions are now the midyear updates.</span>
        <span class="n">minor_version</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">major_version</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">compat_version</span> <span class="o">=</span> <span class="n">major_version</span><span class="p">,</span> <span class="n">minor_version</span>
            <span class="n">binary_formats</span> <span class="o">=</span> <span class="n">_mac_binary_formats</span><span class="p">(</span><span class="n">compat_version</span><span class="p">,</span> <span class="n">arch</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">binary_format</span> <span class="ow">in</span> <span class="n">binary_formats</span><span class="p">:</span>
                <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;macosx_</span><span class="si">{</span><span class="n">major_version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">minor_version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">binary_format</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">version</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1"># Mac OS 11 on x86_64 is compatible with binaries from previous releases.</span>
        <span class="c1"># Arm64 support was introduced in 11.0, so no Arm binaries from previous</span>
        <span class="c1"># releases exist.</span>
        <span class="c1">#</span>
        <span class="c1"># However, the &quot;universal2&quot; binary format can have a</span>
        <span class="c1"># macOS version earlier than 11.0 when the x86_64 part of the binary supports</span>
        <span class="c1"># that version of macOS.</span>
        <span class="n">major_version</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">arch</span> <span class="o">==</span> <span class="s2">&quot;x86_64&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">minor_version</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">compat_version</span> <span class="o">=</span> <span class="n">major_version</span><span class="p">,</span> <span class="n">minor_version</span>
                <span class="n">binary_formats</span> <span class="o">=</span> <span class="n">_mac_binary_formats</span><span class="p">(</span><span class="n">compat_version</span><span class="p">,</span> <span class="n">arch</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">binary_format</span> <span class="ow">in</span> <span class="n">binary_formats</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;macosx_</span><span class="si">{</span><span class="n">major_version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">minor_version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">binary_format</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">minor_version</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">compat_version</span> <span class="o">=</span> <span class="n">major_version</span><span class="p">,</span> <span class="n">minor_version</span>
                <span class="n">binary_format</span> <span class="o">=</span> <span class="s2">&quot;universal2&quot;</span>
                <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;macosx_</span><span class="si">{</span><span class="n">major_version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">minor_version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">binary_format</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="ios_platforms">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.ios_platforms">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ios_platforms</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">AppleVersion</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">multiarch</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yields the platform tags for an iOS system.</span>

<span class="sd">    :param version: A two-item tuple specifying the iOS version to generate</span>
<span class="sd">        platform tags for. Defaults to the current iOS version.</span>
<span class="sd">    :param multiarch: The CPU architecture+ABI to generate platform tags for -</span>
<span class="sd">        (the value used by `sys.implementation._multiarch` e.g.,</span>
<span class="sd">        `arm64_iphoneos` or `x84_64_iphonesimulator`). Defaults to the current</span>
<span class="sd">        multiarch value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># if iOS is the current platform, ios_ver *must* be defined. However,</span>
        <span class="c1"># it won&#39;t exist for CPython versions before 3.13, which causes a mypy</span>
        <span class="c1"># error.</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">ios_ver</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined, unused-ignore]</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;AppleVersion&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">release</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])))</span>

    <span class="k">if</span> <span class="n">multiarch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">multiarch</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">_multiarch</span>
    <span class="n">multiarch</span> <span class="o">=</span> <span class="n">multiarch</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

    <span class="n">ios_platform_template</span> <span class="o">=</span> <span class="s2">&quot;ios_</span><span class="si">{major}</span><span class="s2">_</span><span class="si">{minor}</span><span class="s2">_</span><span class="si">{multiarch}</span><span class="s2">&quot;</span>

    <span class="c1"># Consider any iOS major.minor version from the version requested, down to</span>
    <span class="c1"># 12.0. 12.0 is the first iOS version that is known to have enough features</span>
    <span class="c1"># to support CPython. Consider every possible minor release up to X.9. There</span>
    <span class="c1"># highest the minor has ever gone is 8 (14.8 and 15.8) but having some extra</span>
    <span class="c1"># candidates that won&#39;t ever match doesn&#39;t really hurt, and it saves us from</span>
    <span class="c1"># having to keep an explicit list of known iOS versions in the code. Return</span>
    <span class="c1"># the results descending order of version number.</span>

    <span class="c1"># If the requested major version is less than 12, there won&#39;t be any matches.</span>
    <span class="k">if</span> <span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Consider the actual X.Y version that was requested.</span>
    <span class="k">yield</span> <span class="n">ios_platform_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">major</span><span class="o">=</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">minor</span><span class="o">=</span><span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">multiarch</span><span class="o">=</span><span class="n">multiarch</span>
    <span class="p">)</span>

    <span class="c1"># Consider every minor version from X.0 to the minor version prior to the</span>
    <span class="c1"># version requested by the platform.</span>
    <span class="k">for</span> <span class="n">minor</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">ios_platform_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">major</span><span class="o">=</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">minor</span><span class="o">=</span><span class="n">minor</span><span class="p">,</span> <span class="n">multiarch</span><span class="o">=</span><span class="n">multiarch</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">major</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">minor</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">ios_platform_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">major</span><span class="o">=</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="n">minor</span><span class="p">,</span> <span class="n">multiarch</span><span class="o">=</span><span class="n">multiarch</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="android_platforms">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.android_platforms">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">android_platforms</span><span class="p">(</span>
    <span class="n">api_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">abi</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yields the :attr:`~Tag.platform` tags for Android. If this function is invoked on</span>
<span class="sd">    non-Android platforms, the ``api_level`` and ``abi`` arguments are required.</span>

<span class="sd">    :param int api_level: The maximum `API level</span>
<span class="sd">        &lt;https://developer.android.com/tools/releases/platforms&gt;`__ to return. Defaults</span>
<span class="sd">        to the current system&#39;s version, as returned by ``platform.android_ver``.</span>
<span class="sd">    :param str abi: The `Android ABI &lt;https://developer.android.com/ndk/guides/abis&gt;`__,</span>
<span class="sd">        e.g. ``arm64_v8a``. Defaults to the current system&#39;s ABI , as returned by</span>
<span class="sd">        ``sysconfig.get_platform``. Hyphens and periods will be replaced with</span>
<span class="sd">        underscores.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;Android&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">api_level</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">abi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;on non-Android platforms, the api_level and abi arguments are required&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">api_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Python 3.13 was the first version to return platform.system() == &quot;Android&quot;,</span>
        <span class="c1"># and also the first version to define platform.android_ver().</span>
        <span class="n">api_level</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">android_ver</span><span class="p">()</span><span class="o">.</span><span class="n">api_level</span>  <span class="c1"># type: ignore[attr-defined]</span>

    <span class="k">if</span> <span class="n">abi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">abi</span> <span class="o">=</span> <span class="n">sysconfig</span><span class="o">.</span><span class="n">get_platform</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">abi</span> <span class="o">=</span> <span class="n">_normalize_string</span><span class="p">(</span><span class="n">abi</span><span class="p">)</span>

    <span class="c1"># 16 is the minimum API level known to have enough features to support CPython</span>
    <span class="c1"># without major patching. Yield every API level from the maximum down to the</span>
    <span class="c1"># minimum, inclusive.</span>
    <span class="n">min_api_level</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="k">for</span> <span class="n">ver</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">api_level</span><span class="p">,</span> <span class="n">min_api_level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;android_</span><span class="si">{</span><span class="n">ver</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">abi</span><span class="si">}</span><span class="s2">&quot;</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_linux_platforms</span><span class="p">(</span><span class="n">is_32bit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">_32_BIT_INTERPRETER</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">linux</span> <span class="o">=</span> <span class="n">_normalize_string</span><span class="p">(</span><span class="n">sysconfig</span><span class="o">.</span><span class="n">get_platform</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">linux</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;linux_&quot;</span><span class="p">):</span>
        <span class="c1"># we should never be here, just yield the sysconfig one and return</span>
        <span class="k">yield</span> <span class="n">linux</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">is_32bit</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">linux</span> <span class="o">==</span> <span class="s2">&quot;linux_x86_64&quot;</span><span class="p">:</span>
            <span class="n">linux</span> <span class="o">=</span> <span class="s2">&quot;linux_i686&quot;</span>
        <span class="k">elif</span> <span class="n">linux</span> <span class="o">==</span> <span class="s2">&quot;linux_aarch64&quot;</span><span class="p">:</span>
            <span class="n">linux</span> <span class="o">=</span> <span class="s2">&quot;linux_armv8l&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="n">linux</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">archs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;armv8l&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;armv8l&quot;</span><span class="p">,</span> <span class="s2">&quot;armv7l&quot;</span><span class="p">]}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="p">[</span><span class="n">arch</span><span class="p">])</span>
    <span class="k">yield from</span> <span class="n">_manylinux</span><span class="o">.</span><span class="n">platform_tags</span><span class="p">(</span><span class="n">archs</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">_musllinux</span><span class="o">.</span><span class="n">platform_tags</span><span class="p">(</span><span class="n">archs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">arch</span> <span class="ow">in</span> <span class="n">archs</span><span class="p">:</span>
        <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;linux_</span><span class="si">{</span><span class="n">arch</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_generic_platforms</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">yield</span> <span class="n">_normalize_string</span><span class="p">(</span><span class="n">sysconfig</span><span class="o">.</span><span class="n">get_platform</span><span class="p">())</span>


<div class="viewcode-block" id="platform_tags">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.platform_tags">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">platform_tags</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides the platform tags for this installation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mac_platforms</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;iOS&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ios_platforms</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Android&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">android_platforms</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_linux_platforms</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_generic_platforms</span><span class="p">()</span></div>



<div class="viewcode-block" id="interpreter_name">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.interpreter_name">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">interpreter_name</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the name of the running interpreter.</span>

<span class="sd">    Some implementations have a reserved, two-letter abbreviation which will</span>
<span class="sd">    be returned when appropriate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">name</span>
    <span class="k">return</span> <span class="n">INTERPRETER_SHORT_NAMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">name</span></div>



<div class="viewcode-block" id="interpreter_version">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.interpreter_version">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">interpreter_version</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">warn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the version of the running interpreter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">_get_config_var</span><span class="p">(</span><span class="s2">&quot;py_version_nodot&quot;</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="n">warn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">_version_nodot</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">version</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_version_nodot</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="n">PythonVersion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>


<div class="viewcode-block" id="sys_tags">
<a class="viewcode-back" href="../../autoapi/packaging/tags/index.html#packaging.tags.sys_tags">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sys_tags</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">warn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tag</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the sequence of tag triples for the running interpreter.</span>

<span class="sd">    The order of the sequence corresponds to priority order for the</span>
<span class="sd">    interpreter, from most to least important.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">interp_name</span> <span class="o">=</span> <span class="n">interpreter_name</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">interp_name</span> <span class="o">==</span> <span class="s2">&quot;cp&quot;</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">cpython_tags</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="n">warn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">generic_tags</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">interp_name</span> <span class="o">==</span> <span class="s2">&quot;pp&quot;</span><span class="p">:</span>
        <span class="n">interp</span> <span class="o">=</span> <span class="s2">&quot;pp3&quot;</span>
    <span class="k">elif</span> <span class="n">interp_name</span> <span class="o">==</span> <span class="s2">&quot;cp&quot;</span><span class="p">:</span>
        <span class="n">interp</span> <span class="o">=</span> <span class="s2">&quot;cp&quot;</span> <span class="o">+</span> <span class="n">interpreter_version</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="n">warn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">interp</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">yield from</span> <span class="n">compatible_tags</span><span class="p">(</span><span class="n">interpreter</span><span class="o">=</span><span class="n">interp</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>