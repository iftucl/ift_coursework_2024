modules.output.data_clean
=========================

.. py:module:: modules.output.data_clean

.. autoapi-nested-parse::

   This script processes CSR indicator data from multiple CSV files.
   It performs the following steps:
       - Concatenates two sets of scraped CSR indicator data.
       - Cleans the report year column.
       - Cleans and standardizes renewable energy usage values.
       - Removes outliers and handles units for several CSR indicators.
       - Renames columns to include unit information.
       - Processes fractional columns (e.g., percentages) and removes values > 100.
       - Removes duplicate and invalid rows.
       - Saves the cleaned CSR indicators to a CSV file.
       - Standardizes company names by matching them with a standard company list,
         using fuzzy matching with a configurable threshold.
       - Saves the final standardized company indicators to a CSV file.



Attributes
----------

.. autoapisummary::

   modules.output.data_clean.csr_indicators1
   modules.output.data_clean.csr_indicators2
   modules.output.data_clean.csr_indicators
   modules.output.data_clean.csr_indicators
   modules.output.data_clean.valid_units
   modules.output.data_clean.renamed_columns
   modules.output.data_clean.csr_indicators
   modules.output.data_clean.columns_to_process
   modules.output.data_clean.csr_indicators
   modules.output.data_clean.csr_indicators
   modules.output.data_clean.standard_df
   modules.output.data_clean.messy_df
   modules.output.data_clean.standard_names
   modules.output.data_clean.messy_names
   modules.output.data_clean.messy_df
   modules.output.data_clean.messy_df


Functions
---------

.. autoapisummary::

   modules.output.data_clean.clean_energy_value
   modules.output.data_clean.clean_and_strip_unit
   modules.output.data_clean.match_company


Module Contents
---------------

.. py:data:: csr_indicators1
   :value: None


.. py:data:: csr_indicators2
   :value: None


.. py:data:: csr_indicators
   :value: None


.. py:data:: csr_indicators

.. py:function:: clean_energy_value(x)

   Clean and standardize an energy usage value.

   Attempts to convert a string representing energy usage to a standardized format with "MWh" as the unit.
   If the value is expressed in GWh or TWh, it is converted into MWh.

   :param x: A value (string or numeric) representing the energy usage.

   :returns: A string in the format "[numeric value] MWh". If conversion fails, returns an empty string.


.. py:data:: valid_units

.. py:function:: clean_and_strip_unit(cell, valid_unit)

   Clean a cell value by extracting the numeric component if the specified valid unit is present.

   :param cell: The cell value to process.
   :param valid_unit: The unit that the cell value should contain.

   :returns: The numeric part of the cell as a string if the unit is present; otherwise, an empty string.


.. py:data:: renamed_columns

.. py:data:: csr_indicators

.. py:data:: columns_to_process
   :value: ['Sustainable Materials Usage Ratio (percent)', 'Waste Recycling Rate (percent)']


.. py:data:: csr_indicators

.. py:data:: csr_indicators

.. py:data:: standard_df
   :value: None


.. py:data:: messy_df
   :value: None


.. py:data:: standard_names

.. py:data:: messy_names

.. py:function:: match_company(name, choices, threshold=80)

   Match a company name to a list of standard names using fuzzy string matching.

   Uses fuzzywuzzy's extractOne function to find the best match. If the score is above the threshold,
   the best match is returned; otherwise, None is returned.

   :param name: The company name to match.
   :param choices: A list of standard company names.
   :param threshold: An integer threshold for a valid match (default is 80).

   :returns: A matched company name if the similarity score exceeds the threshold; otherwise, None.


.. py:data:: messy_df

.. py:data:: messy_df

