modules.db.data_storage
=======================

.. py:module:: modules.db.data_storage


Functions
---------

.. autoapisummary::

   modules.db.data_storage.store_clean_data_to_postgres


Module Contents
---------------

.. py:function:: store_clean_data_to_postgres(cleaned_csv_path: str)

   Store cleaned CSR indicator data into a PostgreSQL database.

   This function reads a cleaned CSV file containing company sustainability indicators
   and writes the data into a PostgreSQL table `csr_reporting.company_indicators`.
   If the table or schema does not exist, they will be created. If the table already exists,
   the new data will be appended.

   Environment variables must be set via a `.env` file or system environment for:
   - POSTGRES_USER
   - POSTGRES_PASSWORD
   - POSTGRES_HOST
   - POSTGRES_PORT
   - POSTGRES_DB

   The CSV file is expected to have the following columns (in order):
   - company
   - year
   - annual_carbon_emissions_tonnes_co2
   - annual_carbon_emissions_reduction_percent
   - annual_water_use_cubic_meters
   - annual_water_use_reduction_percent
   - renewable_energy_use_mwh
   - sustainable_materials_ratio_percent
   - waste_recycling_rate_percent

   :param cleaned_csv_path: Path to the cleaned CSV file containing CSR indicator data.
   :type cleaned_csv_path: str

   :raises psycopg2.Error: If connection to the PostgreSQL database fails.
   :raises pandas.errors.EmptyDataError: If the CSV file is empty or unreadable.
   :raises ValueError: If column count or names in the CSV do not match expected schema.


